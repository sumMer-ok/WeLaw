# EnofLaw 软件详细设计文档

## 文档信息

| 项目 | 内容 |
|------|------|
| 产品名称 | EnofLaw - 普通法学习平台 |
| 目标用户 | 普通法学习者（法学院学生、法律从业者、法学研究者） |
| 核心场景 | 案例研究、法律英语学习、知识库构建 |
| 技术栈 | 前端: Vue3 + ElementPlus, 后端: SpringBoot + Mybatis + PageHelper, 数据库: MySQL |
| 版本 | v1.0 |
| 更新日期 | 2026-02-22 |

---

## 目录

1. [产品概述与用户背景](#1-产品概述与用户背景)
2. [系统架构设计](#2-系统架构设计)
3. [案例管理模块](#3-案例管理模块)
4. [法律英语学习模块](#4-法律英语学习模块)
5. [知识库管理模块](#5-知识库管理模块)
6. [AI集成模块](#6-ai集成模块)
7. [用户界面模块](#7-用户界面模块)
8. [数据管理模块](#8-数据管理模块)
9. [关联与跳转功能系统](#9-关联与跳转功能系统)
10. [模块间协调与数据流](#10-模块间协调与数据流)
11. [用户流程图](#11-用户流程图)

---

## 1. 产品概述与用户背景

### 1.1 产品定位

EnofLaw是一款专为普通法学习者设计的综合性学习平台，旨在解决法律学习者在案例研究、法律英语学习和知识管理方面的痛点。产品融合MarginNote的案例标注与思维导图功能、Notion的知识库管理功能、Anki的间隔重复记忆系统，以及AI智能分析能力，为普通法学习者提供一站式学习解决方案。

### 1.2 目标用户画像

**主要用户群体：**

| 用户类型 | 特征描述 | 核心需求 |
|----------|----------|----------|
| 法学院学生 | 正在学习普通法课程，需要大量阅读案例 | 案例整理、标注、复习 |
| 法律从业者 | 需要持续学习新案例，准备执业考试 | 案例检索、对比分析、知识更新 |
| 法学研究者 | 进行专题研究，需要系统整理文献 | 知识库构建、关联分析、论文写作辅助 |
| 法律英语爱好者 | 希望提升法律英语能力 | 词汇学习、翻译工具、例句积累 |

### 1.3 用户核心痛点

1. **案例阅读效率低**：传统PDF阅读器无法满足法律案例的深度阅读需求，缺乏标注、关联、复习功能
2. **法律知识碎片化**：案例、笔记、词汇分散在不同工具中，难以形成系统知识体系
3. **法律英语学习困难**：专业术语多，缺乏语境化学习工具，记忆效果差
4. **复习规划不科学**：依赖人工安排复习，容易遗忘，学习效率低
5. **案例分析依赖人工**：需要大量时间提取争议点和法律规则

### 1.4 产品价值主张

- **一站式学习平台**：案例阅读、标注、笔记、词汇学习、复习规划全部集成
- **AI智能辅助**：自动提取案例要素、智能推荐学习内容、个性化学习路径
- **科学记忆系统**：基于艾宾浩斯曲线的间隔重复，提高记忆效率
- **知识网络构建**：双向链接、思维导图、知识图谱，构建个人法律知识库

---

## 2. 系统架构设计

### 2.1 整体架构图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              前端层 (Vue3 + ElementPlus)                      │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐       │
│  │ 案例阅读器   │ │ 思维导图     │ │ 闪卡学习     │ │ AI助手       │       │
│  └──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘       │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐       │
│  │ 翻译工具     │ │ 知识库       │ │ 学习集       │ │ 用户设置     │       │
│  └──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘       │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                           后端层 (SpringBoot)                               │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        API Gateway                                  │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐       │
│  │ 案例管理服务 │ │ 词汇学习服务 │ │ AI集成服务   │ │ 知识库服务   │       │
│  └──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘       │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐       │
│  │ 用户服务     │ │ 文件服务     │ │ 搜索服务     │ │ 通知服务     │       │
│  └──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘       │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                    Mybatis + PageHelper (数据访问)                  │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                              数据层                                         │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐       │
│  │ MySQL        │ │ Redis        │ │ Elasticsearch│ │ 文件存储     │       │
│  │ (主数据库)   │ │ (缓存)       │ │ (全文搜索)   │ │ (PDF/图片)   │       │
│  └──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘       │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                           外部服务集成                                      │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐       │
│  │ OpenAI API   │ │ Claude API   │ │ 翻译API      │ │ OCR服务      │       │
│  └──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘       │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2.2 技术选型说明

| 层级 | 技术选型 | 选型理由 |
|------|----------|----------|
| 前端框架 | Vue3 + TypeScript | 响应式系统、Composition API、类型安全 |
| UI组件库 | ElementPlus | 企业级组件、完善的中文文档 |
| 状态管理 | Pinia | Vue3官方推荐、TypeScript友好 |
| 后端框架 | SpringBoot 3.x | 生态成熟、微服务支持、性能优秀 |
| ORM框架 | Mybatis | 灵活的SQL控制、复杂查询支持 |
| 分页插件 | PageHelper | 简单易用、与Mybatis无缝集成 |
| 数据库 | MySQL 8.0 | 成熟稳定、全文索引支持 |
| 缓存 | Redis | 高性能、支持多种数据结构 |
| 搜索引擎 | Elasticsearch | 强大的全文搜索、法律术语分词 |

---

## 3. 案例管理模块

### 3.1 功能概述

案例管理模块是整个软件的核心，参照飞书云文档的协作体验和Zotero的文献管理功能，提供完整的案例生命周期管理。支持纯文本和PDF格式的案例导入、流畅的阅读体验、多维度标注系统、AI智能分析和案例关联对比功能。

**设计原则：**
- **简洁高效**：减少弹窗，采用就地编辑和侧边面板
- **视觉清晰**：卡片式布局，信息层次分明
- **灵活组织**：标签+文件夹混合，支持多对多关联
- **沉浸式阅读**：三栏布局，目录可折叠，专注阅读体验

### 3.2 详细功能设计

#### 3.2.1 案例导入功能

**支持的导入方式：**

| 导入方式 | 支持格式 | 功能特性 | 技术实现 |
|----------|----------|----------|----------|
| 本地文件导入 | PDF, TXT | 支持批量选择、拖拽上传、进度显示 | Apache PDFBox解析PDF，原生读取TXT |
| URL导入 | 网页链接 | 自动抓取网页内容，支持普通法数据库网站 | Jsoup网页抓取 |
| 剪贴板导入 | 文本内容 | 快速粘贴案例文本 | 系统剪贴板API |
| 扫描导入 | 图片(PNG, JPG) | 集成OCR识别，支持多语言 | Tesseract OCR |

**PDF导入技术规格：**

```
PDF处理流程:
用户上传PDF → 文件格式验证 → PDF解析提取文本 → 页面渲染优化 → 元数据提取 → 案例预览 → 确认保存

技术细节:
- 解析引擎: Apache PDFBox 2.x
- 渲染方式: 服务端生成图片预览 + 前端Canvas渲染
- 大文件处理: 分页加载，首屏优先
- 格式支持: 纯文字PDF、扫描版PDF(OCR后处理)
```

**导入流程：**
```
用户选择导入方式 → 文件解析 → OCR识别(如需要) → 元数据提取 → 案例预览 → 确认保存
```

**自动元数据提取：**
- 案例标题（自动识别标题格式，正则匹配v.连接符）
- 法院名称（匹配法院关键词库：Supreme Court, High Court等）
- 判决日期（日期格式识别：YYYY-MM-DD, Month DD, YYYY等）
- 当事人信息（原告/被告识别：Plaintiff/Defendant, Appellant/Respondent等）
- 案号（正则表达式匹配：[2024] UKSC 1等格式）
- 法官姓名（人名识别算法 + 法官头衔库）

**导入界面设计：**
```
┌─────────────────────────────────────────────────────────────┐
│  导入案例                                                    │
├─────────────────────────────────────────────────────────────┤
│  [拖拽文件到此处] 或 [选择文件] [输入URL] [粘贴文本]         │
│                                                             │
│  已选择文件:                                                │
│  ┌───────────────────────────────────────────────────────┐  │
│  │ 📄 Smith v. Jones.pdf  (2.3MB)  [预览] [删除]         │  │
│  │ 📄 Contract Law Case.txt  (156KB)  [预览] [删除]     │  │
│  └───────────────────────────────────────────────────────┘  │
│                                                             │
│  自动识别信息:                                              │
│  标题: Smith v. Jones                                       │
│  法院: Supreme Court of the United States                   │
│  日期: 2024-01-15                                           │
│  [编辑信息] [确认导入]                                      │
└─────────────────────────────────────────────────────────────┘
```

#### 3.2.2 案例库主界面

**主界面布局（卡片式）：**

```
┌─────────────────────────────────────────────────────────────┐
│  EnofLaw案例库                                    [🔍] [👤] │
├─────────────────────────────────────────────────────────────┤
│  全部案例 | 宪法 | 刑法 | 合同法 | 侵权法 | 证据法 | + 新建   │  ← 顶部筛选栏
├─────────────────────────────────────────────────────────────┤
│  排序: 最近阅读 ▼  筛选: 全部 ▼  [列表视图 | 卡片视图]        │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  📄                                                  │   │
│  │  Brown v. Board of Education                        │   │
│  │  347 U.S. 483                                       │   │
│  │  种族隔离与教育平等                                  │   │
│  │                                                     │   │
│  │  [宪法] [已掌握]        ✏️ 20  📅 1954年5月17日      │   │
│  │                                                     │   │
│  │  [宪法] [平等保护] [教育]                           │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  📄                                                  │   │
│  │  Smith v. Jones                                     │   │
│  │  [2024] UKSC 1                                      │   │
│  │  合同违约与损害赔偿                                  │   │
│  │                                                     │   │
│  │  [合同法] [学习中]      ✏️ 5   📅 2024年1月15日      │   │
│  │                                                     │   │
│  │  [违约] [损害赔偿] [Hadley规则]                     │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

**案例卡片信息结构（参照图一）：**

| 元素 | 位置 | 说明 |
|------|------|------|
| 文件图标 | 左上角 | 案例类型标识（PDF/TXT） |
| 更多操作 | 右上角 | 悬停显示下拉菜单（编辑、删除、移动） |
| 案例标题 | 中部 | 粗体显示，最多两行 |
| 引用格式 | 标题下方 | 斜体显示，如 "347 U.S. 483" |
| 案例摘要 | 引用下方 | 简短描述案例主题 |
| 分类标签 | 底部左侧 | 彩色标签（宪法、合同法等） |
| 学习状态 | 分类标签旁 | 状态标签（已掌握/学习中/待学习） |
| 标注数量 | 底部右侧 | ✏️ 图标 + 数量 |
| 判决日期 | 底部右侧 | � 图标 + 日期 |
| 关键词标签 | 最底部 | 案例相关关键词 |

**视图切换：**

| 视图模式 | 特点 | 适用场景 |
|----------|------|----------|
| 列表视图 | 紧凑，一屏显示更多案例 | 快速浏览、批量操作 |
| 卡片视图 | 信息完整，视觉清晰 | 详细查看、选择阅读 |

**顶部筛选栏：**

- 快速筛选：全部案例、各分类文件夹
- 支持横向滚动（文件夹过多时）
- "+ 新建"按钮：快速新建文件夹

**高级筛选：**

| 筛选维度 | 选项 |
|----------|------|
| 学习状态 | 全部 / 待学习 / 学习中 / 已掌握 |
| 法律领域 | 全部 / 宪法 / 刑法 / 合同法 / 侵权法 / 证据法 |
| 阅读时间 | 全部 / 今天 / 本周 / 本月 / 更早 |
| 标注数量 | 全部 / 有标注 / 无标注 |
| 排序方式 | 最近阅读 / 最近添加 / 判决日期 / 标题字母 |

#### 3.2.3 案例阅读功能

**阅读器界面布局（三栏，目录可隐藏）：**

```
┌─────────────────────────────────────────────────────────────────────────┐
│  ← 返回案例库    Smith v. Jones      [分享] [AI分析] [评论💬2] [⚙️]      │
│                 [2024] UKSC 1                                           │
├─────────────────────────────────────────────────────────────────────────┤
│  ┌──────────┬──────────────────────────────┬─────────────────────────┐  │
│  │  📑 目录   │                              │      评论 (2)      [×]  │  │
│  │  ────────  │   Smith v. Jones            │  ┌───────────────────┐  │  │
│  │  1. 案件   │                              │  │ 👤 法律学习者      │  │  │
│  │     事实   │   Supreme Court  2024-01-15  │  │ 刚刚              │  │  │
│  │  2. 争议   │   [合同法]                   │  │ ┌───────────────┐ │  │  │
│  │     焦点   │                              │  │ │"The defendant │ │  │  │
│  │  3. 判决   │   ──────────────────────     │  │ │breached..."   │ │  │  │
│  │     理由   │                              │  │ └───────────────┘ │  │  │
│  │  4. 结论   │   1 IN THE SUPREME COURT     │  │ 这是本案的关键...  │  │  │
│  │            │      OF THE UNITED...        │  │ [👍 3] [回复]      │  │  │
│  │  [折叠 ◀]  │                              │  └───────────────────┘  │  │
│  └──────────┴──────────────────────────────┴─────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────┘
```

**顶部导航栏：**

| 元素 | 位置 | 功能 |
|------|------|------|
| 返回按钮 | 左侧 | 返回案例库列表 |
| 案例标题 | 居中 | 粗体显示案例名称 |
| 引用格式 | 标题下方 | 斜体显示引用格式 |
| 分享按钮 | 右侧 | 分享案例链接 |
| AI分析 | 右侧 | 打开AI分析面板 |
| 评论按钮 | 右侧 | 显示评论数量，点击展开/收起评论面板 |
| 关联笔记 | 右侧 | 双屏显示关联笔记 |
| 案例对比 | 右侧 | 双屏显示相关案例对比 |
| 设置按钮 | 右侧 | 阅读设置（字体、主题等） |

**案例元信息区域（标题下方居中）：**

```
┌─────────────────────────────────────────┐
│  [Supreme Court] [2024-01-15] [合同法]  │
└─────────────────────────────────────────┘
```

- 法院名称：蓝色标签
- 判决日期：灰色标签
- 法律分类：彩色标签（根据分类显示不同颜色）

**阅读功能规格：**

| 功能 | 描述 | 技术实现 |
|------|------|----------|
| 布局 | 三栏布局，目录可隐藏/显示 | CSS Grid + 状态管理 |
| 文本渲染 | 流畅的文档渲染，支持大文件 | 虚拟滚动 + 分页加载 |
| 文本编辑 | 支持Markdown格式编辑，保持原文风格 | Milkdown编辑器 + 自定义样式 |
| 目录导航 | 可折叠的左侧目录大纲 | 标题层级解析 + 折叠动画 |
| 段落编号 | 可选显示/隐藏段落编号 | 动态渲染 |
| 边距调整 | 自适应边距（根据屏幕宽度调整） | CSS Media Query |
| 翻页体验 | 平滑翻页动画，键盘快捷键 | CSS动画 + 键盘事件监听 |
| 缩放调整 | 支持50%-200%缩放 | CSS transform scale |
| 夜间模式 | 护眼阅读模式 | CSS变量主题切换 |
| 进度同步 | 自动保存阅读位置 | LocalStorage + 后端同步 |
| 自动保存 | 编辑内容自动保存 | 防抖保存机制 |
| 全屏阅读 | 沉浸式阅读模式 | Fullscreen API |
| 打印优化 | 打印样式优化 | CSS Print Media |
| 导出PDF | 导出带标注和评论的PDF | 后端生成 |

#### 3.2.3 案例标注与评论系统

**标注类型：**

| 标注类型 | 视觉样式 | 快捷键 | 用途 | 数据存储 |
|----------|----------|--------|------|----------|
| 高亮 | 彩色背景（可选） | Ctrl+H | 重点内容标记 | 文本位置 + 颜色 |
| 下划线 | 彩色下划线（可选） | Ctrl+U | 引用或关键语句 | 文本位置 + 颜色 |
| 删除线 | 红色删除线 | Ctrl+Shift+X | 被推翻的内容 | 文本位置 + 样式 |
| 评论 | 浅黄色下划线 | - | 评论标记 | 文本位置 + 颜色 + 可见性 |
| 便签 | 侧边便签图标 | Ctrl+M | 详细笔记 | 文本位置 + 笔记内容 |
| 区域框选 | 红色方框 | Ctrl+R | 图表或特殊区域 | 坐标位置 + 尺寸 |

**标注颜色选择功能：**

| 功能 | 描述 | 交互方式 |
|------|------|----------|
| 高亮颜色选择 | 鼠标悬停"高亮"按钮自动弹出颜色选择菜单 | 悬停触发Dropdown |
| 下划线颜色选择 | 鼠标悬停"下划线"按钮自动弹出颜色选择菜单 | 悬停触发Dropdown |
| 默认颜色 | 点击按钮直接添加默认颜色（高亮-黄色，下划线-红色） | 单击 |
| 图标颜色反馈 | 选择颜色后，图标颜色自动变为选中的颜色 | 动态样式绑定 |

**颜色选项：**
- 高亮：黄色(#FCD34D)、蓝色(#60A5FA)、绿色(#86EFAC)、粉色(#F9A8D4)、紫色(#C4B5FD)
- 下划线：红色(#EF4444)、蓝色(#3B82F6)、绿色(#22C55E)、紫色(#8B5CF6)、橙色(#F97316)

**标注叠加显示：**
- 支持在同一文本位置同时应用多个下划线和高亮标记
- 高亮和下划线独立显示，样式叠加
- 使用扫描线算法处理重叠的标注区域
- 添加 HTML 转义防止 XSS 攻击

**批注功能详细设计：**

```typescript
interface Annotation {
  id: string;                    // 标注唯一ID
  caseId: string;                // 所属案例ID
  type: AnnotationType;          // 标注类型: highlight/underline/comment/strike/note/region
  position: TextPosition;        // 文本位置信息
  content: string;               // 批注内容
  color: string;                 // 标注颜色
  visible?: boolean;             // 评论标注可见性（输入状态控制）
  createdAt: Date;               // 创建时间
  updatedAt: Date;               // 更新时间
  createdBy: string;             // 创建者
  replies: Reply[];              // 回复列表
}

interface TextPosition {
  startParagraph: number;        // 起始段落
  startOffset: number;           // 起始偏移
  endParagraph: number;          // 结束段落
  endOffset: number;             // 结束偏移
  text: string;                  // 标注文本内容（用于恢复）
}

interface Reply {
  id: string;
  content: string;
  createdAt: Date;
  createdBy: string;
  userName: string;              // 用户名
  userAvatar: string;            // 用户头像
  files?: FileAttachment[];      // 附件列表
  parentId?: string;             // 回复的回复（嵌套）
}

interface FileAttachment {
  name: string;                  // 文件名
  url: string;                   // 文件URL
  type: string;                  // 文件类型
}
```

**评论面板设计：**

```
┌─────────────────────────────┐
│  评论 (2)            [×]    │  ← 标题栏，可关闭
├─────────────────────────────┤
│  ┌───────────────────────┐  │
│  │ 👤 法律学习者          │  │  ← 用户头像 + 用户名
│  │ 刚刚                  │  │  ← 相对时间
│  │ ┌───────────────────┐ │  │
│  │ │"The defendant     │ │  │  ← 引用原文（引用块样式）
│  │ │breached..."       │ │  │
│  │ └───────────────────┘ │  │
│  │ 这是本案的关键...      │  │  ← 评论内容（Markdown）
│  │ [👍 3] [回复] [更多]   │  │  ← 点赞、回复、更多操作
│  └───────────────────────┘  │
│                             │
│  ┌───────────────────────┐  │
│  │ 👤 当前用户  1小时前   │  │  ← 回复评论
│  │ 同意，这是核心争议点   │  │
│  └───────────────────────┘  │
│                             │
│  [+ 添加评论]               │  ← 添加评论按钮
└─────────────────────────────┘
```

**评论项结构：**

| 元素 | 说明 | 样式 |
|------|------|------|
| 用户头像 | 圆形头像，默认显示用户名首字 | 40px圆形 |
| 用户名 | 粗体显示 | 深色文字 |
| 发布时间 | 相对时间格式 | 灰色小字 |
| 引用原文 | 左侧边框+浅色背景的引用块 | 斜体显示 |
| 评论内容 | Markdown渲染 | 正常正文 |
| 回复内容 | 缩进显示，层级嵌套 | 略小字号 |
| 点赞按钮 | 显示点赞数量 | 图标+数字 |
| 操作按钮 | 回复、编辑、删除 | 文字按钮 |

**评论功能规格：**

| 功能 | 描述 | 技术实现 |
|------|------|----------|
| 面板显示 | 可调整宽度，可关闭 | 右侧抽屉，拖拽调整 |
| 评论排序 | 按正文顺序排列 | 根据标注位置排序 |
| 评论输入 | Markdown格式，支持图片、附件 | Milkdown编辑器 |
| @提及 | 支持@用户、@案例、@笔记 | 悬停预览小窗 |
| 双向跳转 | 点击评论定位正文，点击标注定位评论 | scrollIntoView + 高亮 |
| 跨行选择 | 支持跨段落选择文本进行标注 | Range API |
| 评论关闭时 | 点击正文评论按钮自动展开并定位 | 事件监听 + 自动展开 |

**@提及功能：**

```
输入 @ 后显示下拉菜单：
┌─────────────────────────────┐
│ 👤 用户                     │
│   法律学习者                │
│   案例分析师                │
│ 📄 案例                     │
│   Hadley v. Baxendale       │
│   Donoghue v. Stevenson     │
│ 📝 笔记                     │
│   合同法学习笔记            │
└─────────────────────────────┘

悬停@内容时显示预览小窗：
┌─────────────────────────────┐
│ Hadley v. Baxendale         │
│ (1854) 9 Exch 341           │
│ 确立了损害赔偿的可预见性...  │
└─────────────────────────────┘
```

**标注工具栏（选中文本后弹出）：**

```
┌─────────────────────────────────────────┐
│ [🖍️ 高亮] [〰️ 下划线] [💬 评论] [📝 笔记] [🌐 翻译] [🎴 牌组] │
└─────────────────────────────────────────┘
```

| 功能 | 操作 | 说明 |
|------|------|------|
| 高亮 | 悬停选色，点击添加 | 多色可选，默认黄色 |
| 下划线 | 悬停选色，点击添加 | 多色可选，默认红色 |
| 评论 | 点击在右侧添加评论 | 关联选中文本 |
| 笔记 | 点击添加到指定笔记 | 支持双页显示 |
| 翻译 | 点击显示悬浮翻译 | 悬浮窗，非抽屉 |
| 牌组 | 点击添加到学习集 | 可多选牌组 |

**评论输入状态控制：**
- 开始添加评论时，下划线标注默认隐藏（visible: false）
- 输入框有内容或添加附件后，下划线自动显示
- 提交评论后，下划线保持显示
- 取消评论时，自动删除临时标注

**删除功能：**
- 高亮/下划线标注：点击后右上角显示删除按钮，点击删除
- 评论：下拉菜单中选择删除，有确认对话框
- 回复：下拉菜单中选择删除，有确认对话框
- 删除后有 ElMessage 提示反馈

**批注操作流程：**
```
用户选中文本 → 弹出标注工具栏 → 选择标注类型 → 添加批注内容 → 保存
                    ↓
            可选操作：
            - 选择标注颜色
            - 添加标签分类
            - 添加图片/文件附件
            - 添加回复
            - 生成闪卡
```

**标注工具栏功能（选中文本后弹出）：**

| 功能 | 图标 | 操作 | 说明 |
|------|------|------|------|
| 高亮 | 🖍️ | 悬停显示颜色选择，点击添加默认黄色高亮 | 多色可选 |
| 下划线 | 〰️ | 悬停显示颜色选择，点击添加默认红色下划线 | 多色可选 |
| 评论 | 💬 | 点击在右侧添加评论 | 关联选中文本 |
| 添加到笔记 | 📝 | 点击添加到指定笔记 | 支持双页显示 |
| 翻译 | 🌐 | 点击显示悬浮翻译界面 | 悬浮窗，非抽屉 |
| 添加牌组 | 🎴 | 点击添加到学习集/牌组 | 可多选牌组 |

**添加到笔记功能：**
- 点击"添加到笔记"按钮，弹出笔记选择对话框
- 可选择已有笔记或创建新笔记
- 支持案例和笔记双页显示模式
- 点击笔记中的引用可定位回案例原文

**翻译功能：**
- 悬浮翻译界面（非抽屉式）
- 显示法律术语翻译和释义
- 支持添加生词到词汇本
- 支持朗读发音

**添加牌组功能：**
- 点击"添加牌组"按钮，弹出牌组选择对话框
- 支持多选，可同时添加到多个牌组
- 自动提取选中文本作为卡片正面
- 可编辑卡片正反面内容
- 支持添加标签和备注

#### 3.2.4 全文搜索与高级筛选

**全局搜索（Ctrl+K）：**

```
┌─────────────────────────────────────────────────────────────┐
│  🔍 搜索案例、笔记、词汇... (Ctrl+K)                         │
├─────────────────────────────────────────────────────────────┤
│  最近搜索: 合同法  损害赔偿  Hadley                          │
├─────────────────────────────────────────────────────────────┤
│  📄 案例 (12)                                               │
│  ┌───────────────────────────────────────────────────────┐  │
│  │ Brown v. Board of Education                           │  │
│  │ 种族隔离与教育平等 - 包含"教育"关键词                  │  │
│  │ [宪法] [已掌握] 📅 1954年5月17日                      │  │
│  └───────────────────────────────────────────────────────┘  │
│  ┌───────────────────────────────────────────────────────┐  │
│  │ Smith v. Jones                                        │  │
│  │ 合同违约与损害赔偿 - 包含"损害赔偿"关键词              │  │
│  │ [合同法] [学习中] 📅 2024年1月15日                    │  │
│  └───────────────────────────────────────────────────────┘  │
│                                                             │
│  📝 笔记 (5)                                                │
│  ┌───────────────────────────────────────────────────────┐  │
│  │ 合同法学习笔记                                        │  │
│  │ 包含"合同法"关键词                                    │  │
│  └───────────────────────────────────────────────────────┘  │
│                                                             │
│  🎴 词汇 (8)                                                │
│  ┌───────────────────────────────────────────────────────┐  │
│  │ damages - 损害赔偿                                    │  │
│  │ 法律释义: 违约救济的主要方式                           │  │
│  └───────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

**搜索范围：**

| 范围 | 搜索内容 | 权重 |
|------|----------|------|
| 案例 | 标题、全文、引用格式、法院 | 高 |
| 笔记 | 标题、内容、标签 | 中 |
| 词汇 | 术语、释义、例句 | 中 |
| 批注 | 批注内容、标签 | 低 |

**高级筛选面板：**

```
┌─────────────────────────────────────────┐
│  高级筛选                               │
├─────────────────────────────────────────┤
│  学习状态                               │
│  ○ 全部  ● 待学习  ○ 学习中  ○ 已掌握  │
│                                         │
│  法律领域                               │
│  ☑ 全部  ☑ 宪法  ☐ 刑法  ☑ 合同法     │
│  ☐ 侵权法  ☐ 证据法                     │
│                                         │
│  阅读时间                               │
│  ○ 全部  ○ 今天  ○ 本周  ● 本月       │
│                                         │
│  标注情况                               │
│  ○ 全部  ● 有标注  ○ 无标注            │
│                                         │
│  排序方式                               │
│  [最近阅读 ▼]                           │
│                                         │
│  [重置]  [应用筛选]                     │
└─────────────────────────────────────────┘
```

**搜索技术实现：**

- 全文索引：Elasticsearch + IK分词器
- 实时搜索：防抖300ms，输入时即时显示结果
- 搜索历史：保存最近20条搜索记录
- 搜索建议：基于用户历史的热词推荐

#### 3.2.5 协作与分享功能

**案例分享：**

| 功能 | 描述 | 实现方式 |
|------|------|----------|
| 生成分享链接 | 生成可访问的案例链接 | 短链接服务 |
| 权限设置 | 只读/可评论/可编辑 | 访问控制列表 |
| 链接有效期 | 永久/7天/30天 | 过期自动失效 |
| 访问密码 | 可选的访问密码保护 | 密码验证 |

**团队共享文件夹：**

```
┌─────────────────────────────────────────────────────────────┐
│  📁 团队共享                                                │
│  ─────────────────────────────────────────────────────────  │
│  📂 2024春季合同法课程                                       │
│     👥 成员: 张老师, 李同学, 王同学 (5人)                   │
│  📂 侵权法案例研究小组                                       │
│     👥 成员: 赵同学, 钱同学 (3人)                           │
│                                                             │
│  [+ 创建共享文件夹]                                         │
└─────────────────────────────────────────────────────────────┘
```

**评论@提及功能：**

- 在评论中输入 `@` 触发用户选择
- 支持提及团队成员
- 被提及用户收到通知
- 点击提及跳转到对应评论

**版本历史：**

| 功能 | 描述 |
|------|------|
| 自动保存 | 每30秒自动保存版本 |
| 版本对比 | 对比不同版本的差异 |
| 版本回退 | 恢复到指定版本 |
| 版本备注 | 为重要版本添加备注 |

#### 3.2.6 快捷键系统

**全局快捷键：**

| 快捷键 | 功能 | 场景 |
|--------|------|------|
| `Ctrl + K` | 打开全局搜索 | 任意页面 |
| `Ctrl + /` | 显示快捷键帮助 | 任意页面 |
| `Ctrl + N` | 新建案例 | 案例库页面 |
| `Ctrl + S` | 保存当前编辑 | 阅读器页面 |

**阅读器快捷键：**

| 快捷键 | 功能 | 说明 |
|--------|------|------|
| `Ctrl + H` | 高亮选中文本 | 需先选中文本 |
| `Ctrl + U` | 下划线选中文本 | 需先选中文本 |
| `Ctrl + Shift + X` | 删除线选中文本 | 需先选中文本 |
| `Ctrl + M` | 添加评论 | 需先选中文本 |
| `Ctrl + F` | 在案例中查找 | 打开查找框 |
| `Ctrl + +` | 放大文本 | 缩放比例增加 |
| `Ctrl + -` | 缩小文本 | 缩放比例减小 |
| `Ctrl + 0` | 重置缩放 | 恢复100% |
| `← / →` | 上/下一段落 | 快速导航 |
| `Home` | 跳到案例开头 | 快速定位 |
| `End` | 跳到案例结尾 | 快速定位 |

**列表视图快捷键：**

| 快捷键 | 功能 |
|--------|------|
| `↑ / ↓` | 选择上一个/下一个案例 |
| `Enter` | 打开选中的案例 |
| `Delete` | 删除选中的案例（需确认） |
| `Ctrl + A` | 全选当前视图案例 |
| `Ctrl + Click` | 多选案例 |
| `Shift + Click` | 范围选择 |

**快捷键自定义：**

```
┌─────────────────────────────────────────────────────────────┐
│  快捷键设置                                                 │
├─────────────────────────────────────────────────────────────┤
│  预设方案: [默认方案 ▼]  [恢复默认]                         │
├─────────────────────────────────────────────────────────────┤
│  全局快捷键                                                 │
│  ─────────────────────────────────────────────────────────  │
│  打开搜索        Ctrl + K              [编辑] [重置]       │
│  新建案例        Ctrl + N              [编辑] [重置]       │
│  保存            Ctrl + S              [编辑] [重置]       │
│                                                             │
│  阅读器快捷键                                               │
│  ─────────────────────────────────────────────────────────  │
│  高亮            Ctrl + H              [编辑] [重置]       │
│  下划线          Ctrl + U              [编辑] [重置]       │
│  添加评论        Ctrl + M              [编辑] [重置]       │
│                                                             │
│                    [保存设置]                               │
└─────────────────────────────────────────────────────────────┘
```

#### 3.2.7 案例对比功能

**多案例并排对比（最多同屏显示三个）：**

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  案例对比                                                [添加案例] [导出]  │
├─────────────────────────────────────────────────────────────────────────────┤
│  ┌──────────────┬──────────────┬──────────────┐                            │
│  │ Smith v.     │ Hadley v.    │ Donoghue v.  │                            │
│  │ Jones        │ Baxendale    │ Stevenson    │                            │
│  │ (2024)       │ (1854)       │ (1932)       │                            │
│  ├──────────────┼──────────────┼──────────────┤                            │
│  │              │              │              │                            │
│  │ 📋 争议点     │ 📋 争议点     │ 📋 争议点     │                            │
│  │ ───────────  │ ───────────  │ ───────────  │                            │
│  │ 合同违约     │ 损害赔偿     │ 过失责任     │                            │
│  │ 与损害赔偿   │ 范围         │ 与注意义务   │                            │
│  │              │              │              │                            │
│  │ ⚖️ 法律规则   │ ⚖️ 法律规则   │ ⚖️ 法律规则   │                            │
│  │ ───────────  │ ───────────  │ ───────────  │                            │
│  │ 适用可预见   │ 确立可预见   │ 邻人原则     │                            │
│  │ 性规则       │ 性规则       │              │                            │
│  │              │              │              │                            │
│  │ 📝 判决结果   │ 📝 判决结果   │ 📝 判决结果   │                            │
│  │ ───────────  │ ───────────  │ ───────────  │                            │
│  │ 支持原告     │ 支持原告     │ 支持原告     │                            │
│  └──────────────┴──────────────┴──────────────┘                            │
└─────────────────────────────────────────────────────────────────────────────┘
```

**对比功能特性：**

| 功能 | 描述 | 实现 |
|------|------|------|
| 添加案例 | 从案例库选择案例添加到对比 | 选择对话框 |
| 删除案例 | 点击案例卡片右上角删除 | 确认后移除 |
| 切换布局 | 双栏/三栏布局切换 | 响应式布局 |
| 导出对比表 | 导出为PDF/Word/Markdown | 多种格式 |
| 高亮差异 | 自动高亮显示差异点 | AI分析 |

**对比维度：**

- 案件事实对比
- 争议焦点对比
- 法律规则对比
- 判决结果对比
- 引用先例对比
- 法院层级对比
- 判决日期对比

**AI对比分析：**

自动分析多个案例的相似点和差异点，生成对比报告：
- 相似案例推荐
- 法律规则演进脉络
- 判决趋势分析

#### 3.2.8 阅读统计与导出

**详细阅读统计：**

```
┌─────────────────────────────────────────────────────────────┐
│  阅读统计 - Smith v. Jones                                  │
├─────────────────────────────────────────────────────────────┤
│  📊 阅读概览                                                │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐       │
│  │  45分钟  │ │   85%    │ │   15     │ │    5     │       │
│  │ 阅读时长  │ │ 阅读进度 │ │ 标注数量 │ │ 笔记数量 │       │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘       │
│                                                             │
│  📈 阅读时间分布（近30天）                                  │
│  [柱状图: 显示每日阅读时长]                                 │
│                                                             │
│  📊 学习趋势                                                │
│  [折线图: 显示阅读时长、标注数量趋势]                       │
│                                                             │
│  📅 阅读历史                                                │
│  • 2024-01-20 阅读 20分钟，添加3个标注                      │
│  • 2024-01-18 阅读 15分钟，添加2个笔记                      │
│  • 2024-01-15 阅读 10分钟                                   │
│                                                             │
│  🏆 学习成就                                                │
│  • 连续阅读5天                                              │
│  • 本周阅读时长排名第3                                      │
│  • 已掌握3个合同法案例                                      │
└─────────────────────────────────────────────────────────────┘
```

**导出功能：**

| 格式 | 内容 | 用途 | 选项 |
|------|------|------|------|
| PDF | 案例全文 + 标注 + 评论 | 打印、存档 | 是否包含标注、评论 |
| Word | 案例全文 + 可编辑 | 编辑、分享 | 保留格式/纯文本 |
| Markdown | 案例文本 + 结构化数据 | 导入其他工具 | 标准/CommonMark |
| JSON | 完整数据结构 | 备份、迁移 | 完整/精简 |

**打印优化：**

- 打印样式优化（隐藏UI元素）
- 标注在打印时显示为边注
- 支持打印预览
- 分页控制
- 页眉页脚自定义

#### 3.2.9 AI智能分析功能

**AI分析功能概述：**

集成AI模型自动提取案例中的法律争议点(issues)和法律规则(rules)，提取准确率目标不低于85%。

**AI分析流程：**
```
用户上传案例 → 文本预处理 → 分段发送AI → 提取关键要素 → 结构化存储 → 展示分析结果
```

**AI提取要素：**

| 要素类型 | 描述 | 示例 | 准确率目标 |
|----------|------|------|------------|
| 争议点(Issues) | 案件的核心法律问题 | Whether the defendant owed a duty of care to the plaintiff | ≥85% |
| 法律规则(Rules) | 适用的法律原则和规则 | The neighbor principle: You must take reasonable care to avoid acts or omissions which you can reasonably foresee would be likely to injure your neighbor | ≥85% |
| 案件事实(Facts) | 关键事实要素 | The defendant manufactured ginger beer, a bottle of which contained a decomposed snail | ≥80% |
| 判决结果(Holding) | 法院的判决结论 | The defendant was liable for negligence | ≥90% |
| 判决理由(Rationale) | 法院的推理过程 | The manufacturer owed a duty of care to the ultimate consumer | ≥80% |

**AI分析界面：**
```
┌─────────────────────────────────────────────────────────────┐
│  AI 智能分析 - Smith v. Jones                               │
├─────────────────────────────────────────────────────────────┤
│  分析进度: [████████████████████░░░░] 85%                   │
│                                                             │
│  ┌───────────────────────────────────────────────────────┐  │
│  │ 📋 争议点 (Issues)                                      │  │
│  │ ─────────────────────────────────────────────────────  │  │
│  │ 1. Whether the defendant breached the contract         │  │
│  │    by failing to deliver goods on time                 │  │
│  │    [定位原文] [编辑] [删除]                            │  │
│  │                                                        │  │
│  │ 2. Whether the plaintiff is entitled to damages        │  │
│  │    for loss of profits                                 │  │
│  │    [定位原文] [编辑] [删除]                            │  │
│  └───────────────────────────────────────────────────────┘  │
│                                                             │
│  ┌───────────────────────────────────────────────────────┐  │
│  │ ⚖️ 法律规则 (Rules)                                     │  │
│  │ ─────────────────────────────────────────────────────  │  │
│  │ 1. Hadley v. Baxendale Rule:                           │  │
│  │    Damages are recoverable for losses that arise       │  │
│  │    naturally and ordinarily from the breach, or        │  │
│  │    that were reasonably foreseeable at the time        │  │
│  │    of contract formation                               │  │
│  │    [定位原文] [编辑] [删除] [添加到词汇库]             │  │
│  └───────────────────────────────────────────────────────┘  │
│                                                             │
│  ┌───────────────────────────────────────────────────────┐  │
│  │ 📝 案件事实 (Key Facts)                                 │  │
│  │ ─────────────────────────────────────────────────────  │  │
│  │ • The contract was for delivery of 100 tons of steel   │  │
│  │ • Delivery was scheduled for December 2023             │  │
│  │ • The defendant failed to deliver on time              │  │
│  └───────────────────────────────────────────────────────┘  │
│                                                             │
│  [重新分析] [导出分析结果] [生成思维导图]                   │
└─────────────────────────────────────────────────────────────┘
```

**AI Prompt设计：**
```
You are a legal analysis assistant specializing in common law case analysis. 
Please analyze the following case text and extract:

1. ISSUES: The legal questions or disputes the court is addressing
2. RULES: The legal principles, doctrines, or precedents applied
3. FACTS: The key material facts of the case
4. HOLDING: The court's decision/conclusion
5. RATIONALE: The court's reasoning

Format your response as JSON:
{
  "issues": ["issue 1", "issue 2"],
  "rules": ["rule 1", "rule 2"],
  "facts": ["fact 1", "fact 2"],
  "holding": "holding text",
  "rationale": "rationale text"
}

Case text:
[案例文本内容]
```

#### 3.2.5 案例关联对比工具

**关联对比功能概述：**

实现基于关键词、法律条款或案例引用的多案例关联功能，支持并排对比查看不同案例的异同点。

**关联类型：**

| 关联类型 | 描述 | 适用场景 |
|----------|------|----------|
| 引用(References) | 案例引用其他案例 | 先例引用分析 |
| 遵循(Followed) | 案例遵循先例原则 | 判例法发展追踪 |
| 推翻(Overrules) | 案例推翻先前判决 | 法律变革分析 |
| 区分(Distinguishes) | 案例区分相似先例 | 细微差别分析 |
| 支持(Supports) | 案例支持某观点 | 论证支持 |
| 对比(Contrasts) | 案例与另一案例对比 | 不同观点分析 |

**对比查看界面：**
```
┌─────────────────────────────────────────────────────────────┐
│  案例对比分析                                                │
├─────────────────────────────────────────────────────────────┤
│  对比案例: Smith v. Jones vs. Hadley v. Baxendale          │
│  [添加对比案例] [切换布局] [导出对比表]                     │
├─────────────────────────────────────────────────────────────┤
│  ┌────────────────────────┬────────────────────────┐       │
│  │  Smith v. Jones        │  Hadley v. Baxendale   │       │
│  │  (2024)                │  (1854)                │       │
│  ├────────────────────────┼────────────────────────┤       │
│  │                        │                        │       │
│  │  📋 争议点              │  📋 争议点              │       │
│  │  ────────────────────  │  ────────────────────  │       │
│  │  合同违约与损害赔偿     │  损害赔偿范围           │       │
│  │                        │                        │       │
│  │  ⚖️ 法律规则            │  ⚖️ 法律规则            │       │
│  │  ────────────────────  │  ────────────────────  │       │
│  │  适用可预见性规则       │  确立可预见性规则       │       │
│  │                        │                        │       │
│  │  📝 判决结果            │  📝 判决结果            │       │
│  │  ────────────────────  │  ────────────────────  │       │
│  │  支持原告               │  支持原告               │       │
│  │                        │                        │       │
│  │  🔗 关联分析            │  🔗 关联分析            │       │
│  │  ────────────────────  │  ────────────────────  │       │
│  │  遵循Hadley规则         │  被Smith案遵循          │       │
│  │                        │                        │       │
│  └────────────────────────┴────────────────────────┘       │
│                                                             │
│  AI对比分析:                                                │
│  两个案例都涉及损害赔偿的可预见性规则，Hadley案确立了该规则，│
│  Smith案在商事合同背景下应用了这一规则...                    │
└─────────────────────────────────────────────────────────────┘
```

**自动关联发现：**
- 基于关键词匹配（法律术语、当事人名称）
- 基于案例引用关系（Citation分析）
- 基于AI语义相似度分析
- 基于法律条款引用

#### 3.2.6 个人笔记系统

**笔记系统概述：**

个人笔记系统参照Zotero文件管理+飞书云文档编辑+MarginNote4联动的设计理念，提供完整的笔记生命周期管理。支持富文本/Markdown即时渲染编辑、多级文件夹管理、多标签分类、双向链接引用、与案例和学习集深度集成。

**核心设计理念：**
- **Zotero风格**：多级文件夹管理、标签系统、元数据管理
- **飞书云文档**：富文本编辑、Markdown即时渲染、全功能块支持
- **MarginNote4**：笔记与案例双向联动、引用卡片、思维导图集成

**1. 笔记库主界面（Zotero风格三栏布局）**

```
┌──────────────┬──────────────┬─────────────────────────────────────┐
│  📁 文件夹    │  📝 笔记列表  │  ✏️ 笔记编辑器                      │
│  （左侧）     │  （中间）     │  （右侧）                           │
├──────────────┼──────────────┼─────────────────────────────────────┤
│              │              │  返回 │ 标题（可编辑）│ 分享 │ 更多   │
│ 📂 全部笔记   │ ┌──────────┐ │                                     │
│ 📂 合同法     │ │标题      │ │  工具栏（富文本格式）                │
│ 📂 侵权法     │ │摘要...   │ │                                     │
│ 📂 宪法       │ │标签1 标签2│ │ ┌─────────────────────────────────┐ │
│   📄 子文件夹 │ └──────────┘ │ │                                 │ │
│ 📂 学习笔记   │ ┌──────────┐ │ │  # 案例摘要                      │ │
│ 📂 待整理     │ │标题      │ │ │                                 │ │
│              │ │摘要...   │ │ │  ## 案件事实                     │ │
│ [+ 新建文件夹]│ └──────────┘ │ │  原告Smith与被告Jones...         │ │
│              │              │ │                                 │ │
│ 🏷️ 标签      │              │ │  > 💡 关键要点                   │ │
│ [合同法]     │              │ │  > 本案涉及合同违约...           │ │
│ [案例笔记]   │              │ │                                 │ │
│ [待复习]     │              │ │  📎 相关案例:                    │ │
│              │              │ │  @Hadley v. Baxendale            │ │
│              │              │ │  @Victoria Laundry v. Newman     │ │
│              │              │ │                                 │ │
│              │              │ │  ```                            │ │
│              │              │ │  损害赔偿 = 预期利益 - 实际损失   │ │
│              │              │ │  ```                            │ │
│              │              │ │                                 │ │
│              │              │ └─────────────────────────────────┘ │
└──────────────┴──────────────┴─────────────────────────────────────┘
```

**2. 编辑器模式（富文本+Markdown即时渲染）**

| 功能类别 | 具体功能 | 快捷键/语法 | 说明 |
|----------|----------|-------------|------|
| **基础格式** | 标题H1-H6 | `#` / `##` / `###` 或 Ctrl+1/2/3 | 支持快捷键和Markdown语法 |
| | 粗体 | `**文字**` 或 Ctrl+B | Markdown语法即时渲染 |
| | 斜体 | `*文字*` 或 Ctrl+I | Markdown语法即时渲染 |
| | 下划线 | Ctrl+U | 富文本功能 |
| | 删除线 | `~~文字~~` | Markdown语法即时渲染 |
| | 行内代码 | `` `代码` `` | Markdown语法即时渲染 |
| | 高亮标记 | `==文字==` 或背景色选择 | 支持Markdown和富文本 |
| **列表** | 无序列表 | `-` 或 `*` 或 Ctrl+Shift+U | Markdown语法即时渲染 |
| | 有序列表 | `1.` 或 Ctrl+Shift+O | Markdown语法即时渲染 |
| | 待办事项 | `- [ ]` 任务 | 可勾选，支持嵌套 |
| | 嵌套列表 | Tab/Shift+Tab | 支持多级嵌套 |
| **区块** | 引用块 | `>` 引用内容 | Markdown语法即时渲染 |
| | 代码块 | ` ```语言 ` | 支持语法高亮 |
| | 表格 | `/table` 或 `|列1|列2|` | 支持行列操作、合并单元格 |
| | 分割线 | `---` | Markdown语法即时渲染 |
| | 折叠块 | `>!` 或 `/fold` | 可折叠内容 |
| **多媒体** | 图片 | `/image` 或拖拽/粘贴 | 本地/URL/拖拽/粘贴 |
| | 图片缩放 | 拖拽边角 | 支持等比缩放 |
| | 图片对齐 | 工具栏按钮 | 左/中/右对齐 |
| | 附件 | `/file` | 支持PDF/Word/Excel等 |
| | 数学公式 | `$公式$` 或 `$$公式$$` | LaTeX语法支持 |
| **链接** | 案例链接 | `@案例名称` 或 `/case` | 双向链接到案例 |
| | 笔记链接 | `@笔记名称` 或 `/note` | 双向链接到笔记 |
| | 文件链接 | `@文件名` 或 `/file` | 链接到文件库 |
| | 外部链接 | `[文字](URL)` | 标准Markdown语法 |

**3. 笔记与案例关联（MarginNote4+Zotero风格）**

**引用方式：**

| 引用类型 | 语法 | 显示效果 | 交互行为 |
|----------|------|----------|----------|
| 案例引用 | `@案例名称` | 蓝色标签显示案例名 | 悬停预览卡片，点击跳转或双屏 |
| 笔记引用 | `@笔记名称` | 绿色标签显示笔记名 | 悬停预览卡片，点击跳转或双屏 |
| 文件引用 | `@文件名` | 灰色标签显示文件名 | 悬停预览，点击打开 |
| 段落引用 | `@案例名#段落3` | 显示"案例名 - 段落3" | 点击定位到具体段落 |

**引用卡片显示：**
```
┌─────────────────────────────────┐
│ 📄 案例引用: Smith v. Jones     │
│ [2024] UKSC 1                   │
│ ├─ 合同违约与损害赔偿           │
│ ├─ 判决日期: 2024-01-15        │
│ └─ [点击查看全文]              │
└─────────────────────────────────┘
```

**从案例创建笔记（引用式）：**
```
场景：用户在案例阅读器中选中文字
操作：点击"添加到笔记"按钮
流程：
1. 弹出笔记选择对话框（已有笔记/新建笔记）
2. 在笔记中插入引用链接，格式：[@案例名 - 段落3]
3. 保存引用关系，支持双向跳转
```

**显示设置：**
- 引用卡片：显示引用内容的预览卡片
- 侧边预览：悬停时显示原文小窗
- 跳转方式：点击后新标签页/分屏显示（用户可设置）
- 双屏模式：左侧笔记，右侧案例

**4. 文件夹系统（Zotero风格）**

| 功能 | 描述 | 实现方式 |
|------|------|----------|
| 多级文件夹 | 支持无限层级嵌套 | 树形结构存储 |
| 文件夹图标 | 支持自定义图标 | 图标选择器 |
| 文件夹颜色 | 支持颜色标记 | 颜色选择器 |
| 智能文件夹 | 根据条件自动归类 | 规则引擎 |
| 文件夹排序 | 拖拽排序 | vuedraggable |
| 快捷操作 | 右键菜单（新建/重命名/删除/移动） | 上下文菜单 |

**文件夹操作：**
- 新建：点击"+"按钮，就地编辑输入名称
- 重命名：右键菜单或悬停显示编辑按钮
- 删除：右键菜单，确认后删除（笔记移动到"未分类"）
- 移动：拖拽笔记到文件夹

**5. 标签系统（多标签+颜色+快捷）**

| 功能 | 描述 | 实现 |
|------|------|------|
| 多标签 | 一个笔记可以有多个标签 | 多对多关系 |
| 标签颜色 | 支持自定义颜色 | 颜色选择器 |
| 标签层级 | 支持父标签/子标签 | 树形结构 |
| 快捷标签 | 常用标签置顶显示 | 使用频率排序 |
| 标签筛选 | 点击标签筛选笔记 | 即时筛选 |

**6. 笔记元数据**

| 元数据项 | 说明 | 显示位置 |
|----------|------|----------|
| 创建时间 | 笔记创建时间 | 笔记信息面板 |
| 最后修改时间 | 最后编辑时间 | 笔记列表/信息面板 |
| 作者 | 创建者 | 笔记信息面板 |
| 字数统计 | 正文字数 | 底部状态栏 |
| 关联案例数 | 引用的案例数量 | 笔记卡片 |
| 关联笔记/文件数 | 引用的笔记和文件数量 | 笔记卡片 |
| 被引用次数 | 被其他笔记引用的次数 | 笔记信息面板 |

**7. 笔记列表展示（信息丰富卡片B样式）**

```
┌─────────────────────────────────────┐
│ 📄 标题（粗体，最多两行）            │
│ ├─ 摘要内容预览（前100字）...       │
│ ├─ 关联案例: Smith v. Jones         │
│ └─ 修改于 2天前                     │
│ [标签1][标签2][标签3]               │
└─────────────────────────────────────┘
```

**列表排序优先级：**
1. 标题
2. 摘要
3. 标签
4. 关联案例名称
5. 最后修改时间

**8. 主题与外观**

| 主题 | 背景色 | 适用场景 |
|------|--------|----------|
| 跟随系统 | #FDF8F3（羊皮纸） | 默认主题 |
| 纯白 | #FFFFFF | 清晰阅读 |
| 深色模式 | #1A1A1A | 夜间阅读 |

**9. 导出与分享**

| 导出格式 | 功能描述 | 技术实现 |
|----------|----------|----------|
| Markdown | 保留完整Markdown语法 | 源码导出 |
| PDF | 带样式的PDF文档 | html2pdf |
| Word (.docx) | 可编辑的Word文档 | 格式转换 |
| 图片 | 长图分享 | html2canvas |
| 分享链接 | 生成只读/可编辑链接 | 权限控制 |
| 打印优化 | 打印友好的样式 | CSS媒体查询 |

**10. 搜索功能**

| 搜索类型 | 功能描述 | 实现方式 |
|----------|----------|----------|
| 全文搜索 | 标题+内容搜索 | Elasticsearch |
| 标签搜索 | 按标签筛选 | 标签索引 |
| 案例关联搜索 | 搜索引用了某案例的笔记 | 关系查询 |
| 高级搜索 | 组合条件筛选 | 多条件查询 |
| 搜索结果高亮 | 关键词高亮显示 | 前端高亮 |

**11. 与现有模块集成**

**与学习集集成：**
- 笔记可以添加到学习集
- 学习集可以创建"综合笔记"（汇总学习集中所有内容）
- 学习集中的笔记显示在思维导图中

**与思维导图集成：**
- 单个笔记可以生成自己的思维导图
- 学习集可生成该学习集的思维导图
- 思维导图节点可以链接到笔记

**与闪卡集成：**
- 闪卡暂时只跟单词库绑定（后续可扩展）

**12. 技术实现**

**编辑器选型：TipTap**
- 理由：Vue3官方推荐、高度可定制、插件丰富、支持协同编辑扩展
- 核心插件：StarterKit、Placeholder、Link、Image、Table、TaskList

**数据存储：混合存储（后续实现）**
- 本地：IndexedDB存储草稿和离线数据
- 云端：MySQL + 接口同步
- 同步策略：自动保存到本地，手动/定时同步到云端

**数据库设计：**

```sql
-- 笔记表
CREATE TABLE notes (
    id VARCHAR(36) PRIMARY KEY COMMENT '笔记ID',
    title VARCHAR(500) NOT NULL COMMENT '笔记标题',
    content LONGTEXT COMMENT '笔记内容（JSON格式存储TipTap文档）',
    content_markdown TEXT COMMENT 'Markdown格式备份',
    folder_id VARCHAR(36) COMMENT '所属文件夹ID',
    tags JSON COMMENT '标签列表',
    author_id VARCHAR(36) COMMENT '作者ID',
    word_count INT COMMENT '字数统计',
    case_refs JSON COMMENT '引用的案例ID列表',
    note_refs JSON COMMENT '引用的笔记ID列表',
    file_refs JSON COMMENT '引用的文件ID列表',
    referenced_count INT DEFAULT 0 COMMENT '被引用次数',
    status VARCHAR(50) COMMENT '状态: draft/published/archived',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_folder (folder_id),
    INDEX idx_author (author_id),
    INDEX idx_updated (updated_at),
    FULLTEXT INDEX idx_content (title, content_markdown) COMMENT '全文搜索索引'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='笔记表';

-- 笔记文件夹表
CREATE TABLE note_folders (
    id VARCHAR(36) PRIMARY KEY COMMENT '文件夹ID',
    name VARCHAR(200) NOT NULL COMMENT '文件夹名称',
    parent_id VARCHAR(36) COMMENT '父文件夹ID',
    icon VARCHAR(100) COMMENT '图标',
    color VARCHAR(20) COMMENT '颜色',
    sort_order INT COMMENT '排序顺序',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (parent_id) REFERENCES note_folders(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='笔记文件夹表';

-- 笔记标签表
CREATE TABLE note_tags (
    id VARCHAR(36) PRIMARY KEY COMMENT '标签ID',
    name VARCHAR(100) NOT NULL COMMENT '标签名称',
    color VARCHAR(20) COMMENT '标签颜色',
    parent_id VARCHAR(36) COMMENT '父标签ID',
    usage_count INT DEFAULT 0 COMMENT '使用次数',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (parent_id) REFERENCES note_tags(id) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='笔记标签表';

-- 笔记-标签关联表
CREATE TABLE note_tag_relations (
    note_id VARCHAR(36) NOT NULL COMMENT '笔记ID',
    tag_id VARCHAR(36) NOT NULL COMMENT '标签ID',
    PRIMARY KEY (note_id, tag_id),
    FOREIGN KEY (note_id) REFERENCES notes(id) ON DELETE CASCADE,
    FOREIGN KEY (tag_id) REFERENCES note_tags(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='笔记标签关联表';
```

#### 3.2.7 文件夹功能增强

**左侧文件夹目录：**

| 功能 | 描述 | 交互方式 |
|------|------|----------|
| 文件夹列表 | 显示案例分类侧边栏，位于案例库页面左侧 | 固定侧边栏 |
| 默认文件夹 | 全部、宪法、刑法、合同法、侵权法、证据法 | 内置分类 |
| 案例数量 | 每个文件夹显示对应的案例数量 | 实时统计 |
| 筛选功能 | 点击文件夹可筛选对应分类的案例 | 点击切换 |

**无弹窗新建文件夹：**

| 功能 | 描述 | 交互方式 |
|------|------|----------|
| 触发方式 | 点击"+"按钮或"新建文件夹"按钮 | 按钮点击 |
| 输入方式 | 直接在列表末尾添加待命名文件夹，显示输入框 | 就地编辑 |
| 确认方式 | 支持Enter确认、失去焦点自动保存 | 键盘/失焦 |
| 取消方式 | 支持ESC取消 | 键盘 |
| 视觉标识 | 新文件夹以绿色虚线边框标识 | CSS样式 |

**无弹窗重命名：**

| 功能 | 描述 | 交互方式 |
|------|------|----------|
| 触发方式 | 鼠标悬停文件夹显示编辑按钮，点击编辑按钮 | 悬停+点击 |
| 编辑模式 | 进入就地编辑模式，显示输入框 | 就地编辑 |
| 保存方式 | 支持Enter保存、失去焦点自动保存 | 键盘/失焦 |
| 取消方式 | 支持ESC取消 | 键盘 |
| 视觉标识 | 编辑状态以淡蓝色背景标识 | CSS样式 |

**拖拽排序：**

| 功能 | 描述 | 技术实现 |
|------|------|----------|
| 拖拽手柄 | 文件夹左侧显示拖拽手柄（⋮⋮） | 图标显示 |
| 拖拽功能 | 支持拖拽调整文件夹顺序 | vuedraggable |
| 固定项 | "全部"文件夹固定在顶部，不可拖拽 | 条件判断 |
| 视觉反馈 | 拖拽时有视觉反馈（半透明、旋转效果） | CSS动画 |

**文件夹UI优化：**

- 选中文件夹有高亮显示（红色边框）
- 操作按钮悬停显示
- 拖拽动画流畅
- 新建/编辑状态视觉区分明显

#### 3.2.8 导入功能增强

**"去查找"按钮：**

| 功能 | 描述 | 位置 |
|------|------|------|
| 按钮显示 | 在导入案例的"剪贴板"标签页中新增"去查找"按钮 | 剪贴板标签页 |
| 功能 | 点击打开案例查找资源面板 | 打开抽屉面板 |

**案例查找资源面板：**

| 功能 | 描述 | 技术实现 |
|------|------|----------|
| 面板样式 | 右侧滑出抽屉式面板 | ElDrawer |
| 分类展示 | 分类展示权威法律数据库链接 | 分组列表 |
| 可折叠章节 | 可折叠的章节设计 | ElCollapse |
| 使用建议 | 使用建议时间线 | 时间线组件 |

**免费权威平台：**

| 平台名称 | 地区 | 特点 |
|----------|------|------|
| BAILII | 英国爱尔兰 | 英国和爱尔兰法律数据库 |
| CommonLII | 国际 | 英联邦法律数据库 |
| AustLII | 澳大利亚 | 澳大利亚法律数据库 |
| CanLII | 加拿大 | 加拿大法律数据库 |
| NZLII | 新西兰 | 新西兰法律数据库 |
| Singapore Law Watch | 新加坡 | 新加坡法律数据库 |
| Oyez | 美国 | 美国最高法院案例 |
| CourtListener | 美国 | 美国法院案例搜索引擎 |
| FindLaw | 美国 | 美国法律资源网站 |

**付费专业数据库：**

| 平台名称 | 特点 |
|----------|------|
| Westlaw | 全球领先的法律数据库 |
| LexisNexis | 综合法律研究平台 |
| Bloomberg Law | 商业法律新闻和分析 |
| LawNet | 新加坡法律数据库 |
| Westlaw AU | 澳大利亚法律数据库 |

**链接卡片展示：**

- 名称、标签（免费/付费）
- URL、描述
- 外部链接安全提示
- 响应式布局适配

### 3.3 数据库设计

**案例表 (cases)：**

```sql
CREATE TABLE cases (
    id VARCHAR(36) PRIMARY KEY COMMENT '案例ID',
    title VARCHAR(500) NOT NULL COMMENT '案例标题',
    citation VARCHAR(200) COMMENT '引用格式',
    court VARCHAR(200) COMMENT '法院名称',
    judgment_date DATE COMMENT '判决日期',
    parties JSON COMMENT '当事人信息 {plaintiff, defendant}',
    case_number VARCHAR(100) COMMENT '案号',
    judges JSON COMMENT '法官列表',
    full_text TEXT COMMENT '案例全文',
    summary TEXT COMMENT '案例摘要',
    key_facts JSON COMMENT '关键事实列表',
    holding TEXT COMMENT '判决结果',
    reasoning TEXT COMMENT '判决理由',
    ai_analysis JSON COMMENT 'AI分析结果 {issues, rules, facts, holding, rationale}',
    folder_id VARCHAR(36) COMMENT '所属文件夹ID',
    tags JSON COMMENT '标签列表',
    category VARCHAR(100) COMMENT '法律领域分类',
    status VARCHAR(50) COMMENT '学习状态: pending/learning/mastered',
    priority VARCHAR(20) COMMENT '优先级: high/medium/low',
    file_path VARCHAR(500) COMMENT '原始文件路径',
    file_type VARCHAR(20) COMMENT '文件类型: pdf/txt',
    page_count INT COMMENT '页数',
    word_count INT COMMENT '字数',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    created_by VARCHAR(36) COMMENT '创建者ID',
    INDEX idx_folder (folder_id),
    INDEX idx_category (category),
    INDEX idx_status (status),
    INDEX idx_judgment_date (judgment_date),
    FULLTEXT INDEX idx_fulltext (full_text, title) WITH PARSER ngram
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='案例表';
```

**标注表 (annotations)：**

```sql
CREATE TABLE annotations (
    id VARCHAR(36) PRIMARY KEY COMMENT '标注ID',
    case_id VARCHAR(36) NOT NULL COMMENT '所属案例ID',
    type VARCHAR(50) NOT NULL COMMENT '标注类型: highlight/underline/comment/strike/note/region',
    position JSON NOT NULL COMMENT '位置信息 {startParagraph, startOffset, endParagraph, endOffset, text}',
    content TEXT COMMENT '批注内容',
    color VARCHAR(20) COMMENT '颜色',
    visible BOOLEAN DEFAULT TRUE COMMENT '评论标注可见性',
    tags JSON COMMENT '标签列表',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    created_by VARCHAR(36) COMMENT '创建者ID',
    FOREIGN KEY (case_id) REFERENCES cases(id) ON DELETE CASCADE,
    INDEX idx_case (case_id),
    INDEX idx_type (type)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='标注表';
```

**批注回复表 (annotation_replies)：**

```sql
CREATE TABLE annotation_replies (
    id VARCHAR(36) PRIMARY KEY COMMENT '回复ID',
    annotation_id VARCHAR(36) NOT NULL COMMENT '所属标注ID',
    content TEXT NOT NULL COMMENT '回复内容',
    user_name VARCHAR(100) COMMENT '用户名',
    user_avatar VARCHAR(500) COMMENT '用户头像URL',
    files JSON COMMENT '附件列表 [{name, url, type}]',
    parent_id VARCHAR(36) COMMENT '父回复ID（嵌套回复）',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    created_by VARCHAR(36) COMMENT '创建者ID',
    FOREIGN KEY (annotation_id) REFERENCES annotations(id) ON DELETE CASCADE,
    INDEX idx_annotation (annotation_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='批注回复表';
```

**评论表 (comments)：**

```sql
CREATE TABLE comments (
    id VARCHAR(36) PRIMARY KEY COMMENT '评论ID',
    case_id VARCHAR(36) NOT NULL COMMENT '所属案例ID',
    paragraph_index INT COMMENT '段落索引',
    selected_text TEXT COMMENT '选中的文本',
    content TEXT NOT NULL COMMENT '评论内容',
    user_name VARCHAR(100) COMMENT '用户名',
    user_avatar VARCHAR(500) COMMENT '用户头像URL',
    files JSON COMMENT '附件列表 [{name, url, type}]',
    reply_count INT DEFAULT 0 COMMENT '回复数量',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    created_by VARCHAR(36) COMMENT '创建者ID',
    FOREIGN KEY (case_id) REFERENCES cases(id) ON DELETE CASCADE,
    INDEX idx_case (case_id),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='评论表';
```

**评论回复表 (comment_replies)：**

```sql
CREATE TABLE comment_replies (
    id VARCHAR(36) PRIMARY KEY COMMENT '回复ID',
    comment_id VARCHAR(36) NOT NULL COMMENT '所属评论ID',
    content TEXT NOT NULL COMMENT '回复内容',
    user_name VARCHAR(100) COMMENT '用户名',
    user_avatar VARCHAR(500) COMMENT '用户头像URL',
    files JSON COMMENT '附件列表 [{name, url, type}]',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    created_by VARCHAR(36) COMMENT '创建者ID',
    FOREIGN KEY (comment_id) REFERENCES comments(id) ON DELETE CASCADE,
    INDEX idx_comment (comment_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='评论回复表';
```

---

## 4. 法律英语学习模块

### 4.1 功能概述

法律英语学习模块参照Anki闪卡系统，结合法律专业特点，提供词汇记忆、例句学习、互动测验等功能，帮助用户掌握法律英语术语。核心功能包括划词查询、单词库管理、智能复习系统。

### 4.2 详细功能设计

#### 4.2.1 语言查询与翻译功能

**划词查询功能：**

| 功能 | 描述 | 触发方式 |
|------|------|----------|
| 单词查询 | 选中单个法律单词或术语 | 鼠标选中后自动弹出 |
| 短语查询 | 选中法律短语 | 鼠标选中后自动弹出 |
| 句子翻译 | 选中完整句子 | 鼠标选中后点击翻译按钮 |
| 整篇翻译 | 翻译整个文档 | 点击文档翻译按钮 |

**翻译面板设计：**
```
┌─────────────────────────────────────────────────────────────┐
│  案例阅读                              [翻译] [划词] [设置] │
├─────────────────────────────────────────────────────────────┤
│  ┌────────────────────────────┬──────────────────────────┐  │
│  │                            │  翻译面板                 │  │
│  │  The defendant breached    │  ──────────────────────   │  │
│  │  the contract by failing   │  原文: breached           │  │
│  │  to deliver the goods      │  翻译: 违反；破坏          │  │
│  │  on time.                  │  音标: /briːtʃt/          │  │
│  │                            │                           │  │
│  │  [选中"breached"]          │  法律释义:                │  │
│  │                            │  未能履行合同义务，构成    │  │
│  │                            │  违约行为                 │  │
│  │                            │                           │  │
│  │                            │  相关词汇:                │  │
│  │                            │  • breach of contract     │  │
│  │                            │  • material breach        │  │
│  │                            │                           │  │
│  │                            │  [添加到生词本] [查看案例] │  │
│  └────────────────────────────┴──────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

**翻译功能规格：**

| 功能 | 要求 | 技术实现 |
|------|------|----------|
| 单词翻译 | 准确率≥95%，包含音标 | 本地法律词典 + AI翻译API |
| 术语翻译 | 符合专业法律术语标准 | 专业法律术语库 |
| 句子翻译 | 保持法律语境准确性 | AI翻译 + 法律领域微调 |
| 整篇翻译 | 中英对照显示 | 分段翻译 + 段落对齐 |
| 翻译历史 | 保存查询记录 | 本地数据库 |

**翻译准确率要求：**
- 法律术语翻译准确率 ≥ 95%
- 句子翻译准确率 ≥ 90%
- 整篇翻译可读性评分 ≥ 4.0/5.0

#### 4.2.2 单词库与卡片生成系统

**单词卡片数据结构：**

```typescript
interface VocabularyCard {
  id: string;                    // 卡片ID
  term: string;                  // 单词/术语
  pronunciation: {               // 发音信息
    ipa: string;                 // 国际音标
    audioUrl: string;            // 发音音频URL
  };
  meanings: Meaning[];           // 释义列表
  examples: Example[];           // 例句列表
  tags: string[];                // 分类标签
  source: {                      // 来源信息
    caseId: string;              // 来源案例ID
    caseTitle: string;           // 案例标题
    paragraph: number;           // 段落位置
  };
  srsData: SRSData;              // 间隔重复数据
  createdAt: Date;
  updatedAt: Date;
}

interface Meaning {
  id: string;
  partOfSpeech: string;          // 词性
  chineseMeaning: string;        // 中文释义
  englishDefinition: string;     // 英文定义
  legalExplanation: string;      // 法律专业解释
  difficulty: 'basic' | 'intermediate' | 'advanced';
}

interface Example {
  id: string;
  sentence: string;              // 原文例句
  translation: string;           // 中文翻译
  source: string;                // 出处
  caseId: string;                // 案例ID
  isUserAdded: boolean;          // 是否用户添加
}

interface SRSData {
  deckId: string;                // 所属牌组ID
  interval: number;              // 复习间隔（天）
  repetition: number;            // 重复次数
  easeFactor: number;            // 容易度因子
  nextReviewDate: Date;          // 下次复习日期
  lastReviewDate: Date;          // 上次复习日期
  reviewCount: number;           // 复习次数
  correctCount: number;          // 正确次数
  wrongCount: number;            // 错误次数
  masteryLevel: number;          // 掌握程度 0-100
}
```

**单词卡片界面：**
```
┌─────────────────────────────────────────────────────────────┐
│  单词卡片 - precedent                                       │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│                      ┌─────────────────┐                    │
│                      │                 │                    │
│                      │   precedent     │                    │
│                      │   /ˈpresɪdənt/  │                    │
│                      │                 │                    │
│                      │   [🔊 播放发音]  │                    │
│                      │                 │                    │
│                      └─────────────────┘                    │
│                                                             │
│  📖 释义:                                                   │
│  【n.】先例；判例                                           │
│                                                             │
│  法律释义:                                                  │
│  An earlier event or action that is regarded as an          │
│  example or guide to be considered in subsequent            │
│  similar circumstances.                                     │
│                                                             │
│  📝 例句:                                                   │
│  "This case could serve as a precedent for future          │
│   employment disputes."                                     │
│                                                             │
│  来源: Brown v. Board of Education (1954)                   │
│                                                             │
│  🏷️ 标签: #合同法 #判例法 #基础术语                         │
│                                                             │
│  [编辑] [添加到复习] [查看案例]                             │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

**卡片生成流程：**
```
用户查询单词 → 系统检索词典 → 自动填充信息 → 用户确认/编辑 → 选择牌组 → 保存卡片
                    ↓
            自动填充内容：
            - 国际音标（有道/剑桥词典API）
            - 中文释义（法律术语库）
            - 英文定义（Black's Law Dictionary）
            - 原始例句（当前案例上下文）
            - 案例出处（自动记录）
```

**内置法律术语库分类：**
```
📚 法律英语词汇库
├── 📁 基础法律术语 (500词)
│   ├── 法院与司法系统
│   ├── 法律程序
│   └── 通用法律概念
├── 📁 合同法 (300词)
│   ├── 合同 formation
│   ├── 合同条款
│   └── 违约与救济
├── 📁 侵权法 (250词)
│   ├── 过失责任
│   ├── 严格责任
│   └── 损害赔偿
├── 📁 刑法 (300词)
│   ├── 犯罪类型
│   ├── 刑事责任
│   └── 刑罚
├── 📁 宪法 (200词)
│   ├── 基本权利
│   ├── 政府结构
│   └── 宪法原则
└── 📁 证据法 (150词)
    ├── 证据类型
    ├── 证据规则
    └── 证明标准
```

#### 4.2.3 智能复习系统

**艾宾浩斯记忆曲线算法：**

参照Anki闪卡系统，实现基于艾宾浩斯记忆曲线的智能复习提醒功能。

**SM-2算法实现：**

```typescript
class SRSAlgorithm {
  // 计算下次复习间隔
  calculateInterval(card: VocabularyCard, quality: number): number {
    // quality: 0-5 评分
    // 0 - 完全忘记
    // 1 - 错误，正确答案很熟悉
    // 2 - 错误，但答案不太难
    // 3 - 正确，但回答困难
    // 4 - 正确，回答顺利
    // 5 - 正确，回答完美

    let { interval, repetition, easeFactor } = card.srsData;

    if (quality < 3) {
      // 回答错误，重置间隔
      repetition = 0;
      interval = 1;
    } else {
      // 回答正确
      repetition += 1;
      
      if (repetition === 1) {
        interval = 1;
      } else if (repetition === 2) {
        interval = 6;
      } else {
        interval = Math.round(interval * easeFactor);
      }
    }

    // 更新容易度因子
    easeFactor = easeFactor + (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02));
    easeFactor = Math.max(1.3, easeFactor); // 最小值为1.3

    return interval;
  }

  // 计算下次复习日期
  calculateNextReviewDate(interval: number): Date {
    const nextDate = new Date();
    nextDate.setDate(nextDate.getDate() + interval);
    return nextDate;
  }
}
```

**复习间隔表：**

| 评分 | 间隔调整 | 记忆状态 |
|------|----------|----------|
| 5 (完美) | 间隔 × 1.3 | 已掌握 |
| 4 (良好) | 间隔 × 1.0 | 已掌握 |
| 3 (困难) | 间隔 × 0.8 | 学习中 |
| 2 (错误) | 重置为1天 | 需加强 |
| 1 (错误) | 重置为1天 | 需加强 |
| 0 (忘记) | 重置为1天 | 需加强 |

**学习模式界面：**

**1. 学习模式（Learning Mode）**
```
┌─────────────────────────────────────────────────────────────┐
│  学习新词: precedent                    进度: 5/20          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│                      ┌─────────────────┐                    │
│                      │                 │                    │
│                      │   precedent     │                    │
│                      │   /ˈpresɪdənt/  │                    │
│                      │                 │                    │
│                      │   [🔊 播放发音]  │                    │
│                      │                 │                    │
│                      └─────────────────┘                    │
│                                                             │
│                      [点击显示答案]                          │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

**2. 答案显示**
```
┌─────────────────────────────────────────────────────────────┐
│  学习新词: precedent                    进度: 5/20          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│                      ┌─────────────────┐                    │
│                      │   precedent     │                    │
│                      │   /ˈpresɪdənt/  │                    │
│                      └─────────────────┘                    │
│                                                             │
│  释义:                                                      │
│  An earlier event or action that is regarded as an          │
│  example or guide to be considered in subsequent            │
│  similar circumstances.                                     │
│                                                             │
│  中文: 先例；判例                                           │
│                                                             │
│  例句:                                                      │
│  "This case could serve as a precedent for future          │
│   employment disputes."                                     │
│                                                             │
│  来源: Brown v. Board of Education (1954)                   │
│                                                             │
│  [再次] [困难] [良好] [简单]                                │
│   1min    6min   10min  4days                               │
└─────────────────────────────────────────────────────────────┘
```

**3. 复习模式（Review Mode）**
- 基于间隔重复算法（SM-2算法）
- 根据掌握程度自动调整复习间隔
- 优先显示即将遗忘的词汇

**4. 测试模式（Quiz Mode）**
```
┌─────────────────────────────────────────────────────────────┐
│  词汇测试 - 合同法                                          │
│  题目: 10/20    正确: 8    剩余时间: 5:23                   │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  题型: 选择题                                               │
│                                                             │
│  "Breach of contract" 的意思是：                            │
│                                                             │
│  ○ A. 合同成立                                              │
│  ○ B. 合同违约                                              │
│  ○ C. 合同解除                                              │
│  ○ D. 合同修改                                              │
│                                                             │
│                    [确认答案]                               │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

**测试题型：**

| 题型 | 描述 | 难度 | 占比 |
|------|------|------|------|
| 选择题 | 四选一选择正确释义 | 简单 | 30% |
| 填空题 | 根据释义填写术语 | 中等 | 25% |
| 判断题 | 判断释义是否正确 | 简单 | 15% |
| 匹配题 | 术语与释义配对 | 中等 | 15% |
| 听写题 | 听发音拼写术语 | 困难 | 10% |
| 例句填空 | 在例句中填入正确术语 | 中等 | 5% |

**复习统计与记忆强度评估：**

```
┌─────────────────────────────────────────────────────────────┐
│  学习统计                                                   │
├─────────────────────────────────────────────────────────────┤
│  学习概览                                                   │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐       │
│  │  1,250   │ │   850    │ │   320    │ │   180    │       │
│  │ 总词汇量  │ │ 已掌握   │ │ 学习中   │ │ 新词汇   │       │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘       │
│                                                             │
│  学习曲线 (近30天)                                          │
│  📈 [折线图显示每日学习量]                                  │
│                                                             │
│  掌握度分布                                                 │
│  🥧 [饼图: 已掌握68% 学习中24% 新学8%]                      │
│                                                             │
│  连续学习: 15天 🔥                                          │
│  今日目标: 新学20词 复习50词 (已完成 15/20, 32/50)          │
│                                                             │
│  薄弱词汇 (需要加强)                                        │
│  1. jurisdiction (错误率 45%)                               │
│  2. negligence (错误率 38%)                                 │
│  3. liability (错误率 32%)                                  │
└─────────────────────────────────────────────────────────────┘
```

**记忆强度评估指标：**

| 指标 | 说明 | 计算方式 |
|------|------|----------|
| 掌握度 | 整体掌握程度 | 正确次数 / 总复习次数 |
| 记忆稳定性 | 记忆保持能力 | 连续正确次数 × 容易度因子 |
| 遗忘概率 | 预测遗忘可能性 | 基于艾宾浩斯曲线计算 |
| 复习紧迫度 | 需要复习的紧急程度 | 当前日期 - 下次复习日期 |

### 4.3 数据库设计

**词汇表 (vocabulary)：**

```sql
CREATE TABLE vocabulary (
    id VARCHAR(36) PRIMARY KEY COMMENT '词汇ID',
    term VARCHAR(200) NOT NULL COMMENT '英文术语',
    pronunciation VARCHAR(200) COMMENT '音标',
    audio_url VARCHAR(500) COMMENT '发音音频URL',
    part_of_speech VARCHAR(50) COMMENT '词性',
    difficulty VARCHAR(20) COMMENT '难度: basic/intermediate/advanced',
    definition TEXT COMMENT '英文定义',
    chinese_meaning TEXT COMMENT '中文释义',
    legal_explanation TEXT COMMENT '法律专业解释',
    field VARCHAR(100) COMMENT '法律领域',
    deck_id VARCHAR(36) COMMENT '所属牌组ID',
    srs_data JSON COMMENT '间隔重复数据 {interval, repetition, easeFactor, nextReviewDate}',
    mastery_level INT DEFAULT 0 COMMENT '掌握程度 0-100',
    review_count INT DEFAULT 0 COMMENT '复习次数',
    correct_count INT DEFAULT 0 COMMENT '正确次数',
    wrong_count INT DEFAULT 0 COMMENT '错误次数',
    last_review_date DATE COMMENT '上次复习日期',
    next_review_date DATE COMMENT '下次复习日期',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    created_by VARCHAR(36) COMMENT '创建者ID',
    INDEX idx_deck (deck_id),
    INDEX idx_next_review (next_review_date),
    INDEX idx_mastery (mastery_level),
    FULLTEXT INDEX idx_term (term) WITH PARSER ngram
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='词汇表';
```

**例句表 (vocabulary_examples)：**

```sql
CREATE TABLE vocabulary_examples (
    id VARCHAR(36) PRIMARY KEY COMMENT '例句ID',
    vocabulary_id VARCHAR(36) NOT NULL COMMENT '所属词汇ID',
    sentence TEXT NOT NULL COMMENT '原文例句',
    translation TEXT COMMENT '中文翻译',
    source VARCHAR(200) COMMENT '出处',
    case_id VARCHAR(36) COMMENT '来源案例ID',
    paragraph_number INT COMMENT '段落编号',
    is_user_added BOOLEAN DEFAULT FALSE COMMENT '是否用户添加',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    FOREIGN KEY (vocabulary_id) REFERENCES vocabulary(id) ON DELETE CASCADE,
    INDEX idx_vocabulary (vocabulary_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='例句表';
```

**词汇标签表 (vocabulary_tags)：**

```sql
CREATE TABLE vocabulary_tags (
    id VARCHAR(36) PRIMARY KEY COMMENT '标签ID',
    vocabulary_id VARCHAR(36) NOT NULL COMMENT '所属词汇ID',
    tag VARCHAR(50) NOT NULL COMMENT '标签名称',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    FOREIGN KEY (vocabulary_id) REFERENCES vocabulary(id) ON DELETE CASCADE,
    UNIQUE KEY uk_vocab_tag (vocabulary_id, tag),
    INDEX idx_tag (tag)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='词汇标签表';
```

**牌组表 (decks)：**

```sql
CREATE TABLE decks (
    id VARCHAR(36) PRIMARY KEY COMMENT '牌组ID',
    name VARCHAR(200) NOT NULL COMMENT '牌组名称',
    description TEXT COMMENT '牌组描述',
    category VARCHAR(100) COMMENT '分类',
    is_built_in BOOLEAN DEFAULT FALSE COMMENT '是否内置牌组',
    card_count INT DEFAULT 0 COMMENT '卡片数量',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    created_by VARCHAR(36) COMMENT '创建者ID',
    INDEX idx_category (category)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='牌组表';
```

---

## 5. 知识库管理模块

### 5.1 功能概述

知识库管理模块参照MarginNote4学习集功能，支持将案例文件、个人笔记及其他导入资料整合到同一学习集中，实现可视化思维导图生成，支持为整个学习集创建综合性笔记，实现知识点的系统化整合。

### 5.2 详细功能设计

#### 5.2.1 学习集构建功能

**学习集概念：**

学习集(Study Set)是一个知识组织单元，可以包含多种类型的学习资料：
- 案例文件（PDF/TXT）
- 个人笔记（Markdown）
- 导入资料（归类为"资料"类型）
- 思维导图
- 闪卡集合

**学习集数据结构：**

```typescript
interface StudySet {
  id: string;                    // 学习集ID
  name: string;                  // 学习集名称
  description: string;           // 学习集描述
  coverImage: string;            // 封面图片
  items: StudySetItem[];         // 学习集项目列表
  mindMap: MindMap;              // 思维导图
  summaryNote: Note;             // 综合笔记
  tags: string[];                // 标签
  createdAt: Date;
  updatedAt: Date;
  createdBy: string;
}

interface StudySetItem {
  id: string;
  type: 'case' | 'note' | 'material' | 'flashcard' | 'mindmap';
  entityId: string;              // 关联实体ID
  title: string;
  order: number;                 // 排序
  addedAt: Date;
}
```

**学习集界面：**
```
┌─────────────────────────────────────────────────────────────┐
│  📚 合同法学习集                              [编辑] [分享] │
├─────────────────────────────────────────────────────────────┤
│  描述: 合同法核心案例与概念整理                              │
│  项目数: 12 │ 创建时间: 2024-01-15                          │
├─────────────────────────────────────────────────────────────┤
│  ┌───────────────────────────────────────────────────────┐  │
│  │  📁 学习集内容                                          │  │
│  │  ────────────────────────────────────────────────────  │  │
│  │  📄 Smith v. Jones (案例)                              │  │
│  │     合同违约与损害赔偿                                  │  │
│  │  📄 Hadley v. Baxendale (案例)                         │  │
│  │     损害赔偿可预见性规则                                │  │
│  │  📝 合同法笔记 (笔记)                                   │  │
│  │     对价与违约救济要点总结                              │  │
│  │  📊 合同法思维导图 (导图)                               │  │
│  │     可视化知识结构                                      │  │
│  │  🎴 合同法核心词汇 (闪卡)                               │  │
│  │     50张卡片待复习                                      │  │
│  │  [+ 添加项目]                                           │  │
│  └───────────────────────────────────────────────────────┘  │
│                                                             │
│  ┌───────────────────────────────────────────────────────┐  │
│  │  🗺️ 思维导图预览                                        │  │
│  │  [查看完整导图]                                         │  │
│  │                    ┌─────────┐                         │  │
│  │                    │ 合同法  │                         │  │
│  │                    └────┬────┘                         │  │
│  │        ┌───────────────┼───────────────┐               │  │
│  │        ▼               ▼               ▼               │  │
│  │   ┌─────────┐    ┌─────────┐    ┌─────────┐           │  │
│  │   │  对价   │    │  违约   │    │  救济   │           │  │
│  │   └─────────┘    └─────────┘    └─────────┘           │  │
│  └───────────────────────────────────────────────────────┘  │
│                                                             │
│  [开始学习] [复习词汇] [导出学习集]                         │
└─────────────────────────────────────────────────────────────┘
```

#### 5.2.2 思维导图功能

**思维导图特性：**

| 特性 | 描述 | 技术实现 |
|------|------|----------|
| 无限画布 | 自由拖拽的无限画布 | Canvas/SVG + 虚拟渲染 |
| 多种布局 | 树形、放射形、组织结构 | 布局算法（D3.js） |
| 节点关联 | 节点关联到原文（点击跳转） | 位置映射 + 超链接 |
| 节点样式 | 自定义颜色、图标、形状 | CSS样式系统 |
| 自动布局 | 自动排列节点位置 | 力导向布局算法 |
| 导出功能 | 导出为PNG/PDF/XMind | 图片生成库 |

**思维导图界面：**
```
┌─────────────────────────────────────────────────────────────┐
│  思维导图 - 合同法学习集                        [列表视图]  │
├─────────────────────────────────────────────────────────────┤
│  工具栏: [添加节点] [删除节点] [连接] [布局] [导出]         │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│                    ┌─────────────┐                          │
│                    │    合同法   │                          │
│                    │   📚 根节点 │                          │
│                    └──────┬──────┘                          │
│           ┌───────────────┼───────────────┐                 │
│           ▼               ▼               ▼                 │
│    ┌─────────────┐ ┌─────────────┐ ┌─────────────┐         │
│    │    对价     │ │    违约     │ │    救济     │         │
│    │   ⚖️ 概念   │ │   ⚖️ 概念   │ │   ⚖️ 概念   │         │
│    └──────┬──────┘ └──────┬──────┘ └──────┬──────┘         │
│           │               │               │                 │
│    [相关案例链接]   [批注引用]     [词汇链接]                │
│                                                             │
│  选中节点: 对价                                             │
│  关联: 3个案例 │ 5个批注 │ 8个词汇                          │
│  [查看详情] [编辑内容] [添加子节点]                         │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

**思维导图节点类型：**

| 节点类型 | 图标 | 用途 | 可关联内容 |
|----------|------|------|------------|
| 根节点 | 📚 | 学习集主题 | 学习集本身 |
| 概念节点 | ⚖️ | 法律概念 | 词汇、定义 |
| 案例节点 | 📄 | 案例 | 案例文件、标注 |
| 批注节点 | 📝 | 批注/笔记 | 标注、笔记 |
| 词汇节点 | 🎴 | 词汇 | 词汇卡片 |
| 问题节点 | ❓ | 思考问题 | 问答对 |

**思维导图数据结构：**

```typescript
interface MindMap {
  id: string;
  studySetId: string;
  nodes: MindMapNode[];
  edges: MindMapEdge[];
  layout: LayoutType;            // 布局类型
  viewport: Viewport;            // 视口状态
}

interface MindMapNode {
  id: string;
  type: NodeType;
  label: string;
  content?: string;
  x: number;
  y: number;
  width: number;
  height: number;
  style: NodeStyle;
  entityId?: string;             // 关联实体ID
  entityType?: string;           // 关联实体类型
  parentId?: string;             // 父节点ID
  children: string[];            // 子节点ID列表
  collapsed: boolean;            // 是否折叠
}

interface MindMapEdge {
  id: string;
  source: string;                // 源节点ID
  target: string;                // 目标节点ID
  label?: string;
  style: EdgeStyle;
}
```

#### 5.2.3 学习集笔记功能

**综合笔记功能：**

允许用户为整个学习集创建综合性笔记，支持笔记与学习集中各元素的关联引用，实现知识点的系统化整合。

**笔记关联引用语法：**

```markdown
# 合同法学习总结

## 核心概念

### 1. 对价 (Consideration)

对价是合同成立的必备要素。在 [[Smith v. Jones]] 中，法院详细讨论了对价的充分性...

相关案例：
- [[Hadley v. Baxendale]] - 确立了损害赔偿的可预见性规则
- [[Victoria Laundry v. Newman]] - 对Hadley规则的应用

关键术语：
- {{consideration}} - 对价
- {{adequate consideration}} - 充分对价

### 2. 违约救济

违约救济的主要方式包括...

[思维导图: 合同法导图]
```

**关联引用类型：**

| 语法 | 类型 | 示例 | 效果 |
|------|------|------|------|
| [[案例名]] | 案例引用 | [[Smith v. Jones]] | 链接到案例 |
| {{词汇}} | 词汇引用 | {{consideration}} | 显示词汇卡片 |
| [批注:ID] | 批注引用 | [批注:123] | 链接到批注 |
| [导图:ID] | 导图引用 | [导图:456] | 嵌入思维导图 |

**学习集笔记界面：**
```
┌─────────────────────────────────────────────────────────────┐
│  学习集笔记: 合同法总结                                     │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  # 合同法核心要点总结                                        │
│                                                             │
│  ## 一、合同成立要素                                         │
│                                                             │
│  ### 1. 要约 (Offer)                                        │
│                                                             │
│  要约是合同成立的起点。在 [[Carlill v. Carbolic Smoke Ball]] │
│  案中，法院认定广告可以构成要约...                           │
│                                                             │
│  相关术语: {{offer}}, {{invitation to treat}}               │
│                                                             │
│  ### 2. 承诺 (Acceptance)                                   │
│                                                             │
│  承诺必须与要约一致...                                       │
│                                                             │
│  ## 二、违约救济                                             │
│                                                             │
│  [思维导图: 违约救济导图]                                    │
│                                                             │
│  主要救济方式：                                              │
│  1. 损害赔偿 - 参见 [[Hadley v. Baxendale]]                 │
│  2. 实际履行                                                 │
│  3. 禁令                                                     │
│                                                             │
│  📊 学习统计: 本笔记关联 8 个案例 │ 15 个词汇 │ 3 个导图    │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 5.3 数据库设计

**学习集表 (study_sets)：**

```sql
CREATE TABLE study_sets (
    id VARCHAR(36) PRIMARY KEY COMMENT '学习集ID',
    name VARCHAR(200) NOT NULL COMMENT '学习集名称',
    description TEXT COMMENT '学习集描述',
    cover_image VARCHAR(500) COMMENT '封面图片URL',
    mind_map_id VARCHAR(36) COMMENT '思维导图ID',
    summary_note_id VARCHAR(36) COMMENT '综合笔记ID',
    tags JSON COMMENT '标签列表',
    item_count INT DEFAULT 0 COMMENT '项目数量',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    created_by VARCHAR(36) COMMENT '创建者ID',
    INDEX idx_created_by (created_by)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='学习集表';
```

**学习集项目表 (study_set_items)：**

```sql
CREATE TABLE study_set_items (
    id VARCHAR(36) PRIMARY KEY COMMENT '项目ID',
    study_set_id VARCHAR(36) NOT NULL COMMENT '所属学习集ID',
    item_type VARCHAR(50) NOT NULL COMMENT '项目类型: case/note/material/flashcard/mindmap',
    entity_id VARCHAR(36) NOT NULL COMMENT '关联实体ID',
    title VARCHAR(200) COMMENT '项目标题',
    item_order INT DEFAULT 0 COMMENT '排序',
    added_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '添加时间',
    FOREIGN KEY (study_set_id) REFERENCES study_sets(id) ON DELETE CASCADE,
    INDEX idx_study_set (study_set_id),
    INDEX idx_entity (entity_id, item_type)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='学习集项目表';
```

**思维导图表 (mind_maps)：**

```sql
CREATE TABLE mind_maps (
    id VARCHAR(36) PRIMARY KEY COMMENT '导图ID',
    study_set_id VARCHAR(36) COMMENT '所属学习集ID',
    name VARCHAR(200) COMMENT '导图名称',
    layout_type VARCHAR(50) DEFAULT 'tree' COMMENT '布局类型: tree/radial/organization',
    nodes JSON COMMENT '节点数据',
    edges JSON COMMENT '边数据',
    viewport JSON COMMENT '视口状态 {x, y, zoom}',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    created_by VARCHAR(36) COMMENT '创建者ID',
    FOREIGN KEY (study_set_id) REFERENCES study_sets(id) ON DELETE SET NULL,
    INDEX idx_study_set (study_set_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='思维导图表';
```

---

## 6. AI集成模块

### 6.1 功能概述

AI集成模块参照Notion AI的设计理念，结合本地案例数据库，提供智能查询、内容生成、学习辅助等功能。所有AI功能基于用户提供的API密钥，数据本地处理保护隐私。

### 6.2 详细功能设计

#### 6.2.1 AI接入配置

**API配置界面：**
```
┌─────────────────────────────────────────────────────────────┐
│  AI 设置                                                    │
├─────────────────────────────────────────────────────────────┤
│  API 提供商                                                 │
│  ○ OpenAI (GPT-4/GPT-3.5)                                  │
│  ○ Anthropic (Claude)                                      │
│  ○ Google (Gemini)                                         │
│  ○ 自定义 API                                              │
│                                                             │
│  API 密钥: [••••••••••••••••••••••••••] [显示] [验证]      │
│                                                             │
│  模型选择: GPT-4 [▼]                                        │
│  温度: 0.7 [────●────]                                      │
│  最大令牌: 2000                                             │
│                                                             │
│  隐私设置                                                   │
│  ☑ 仅使用本地数据作为上下文                                │
│  ☑ 不发送案例全文，仅发送摘要                                │
│  ☐ 允许AI改进回答质量（发送匿名反馈）                        │
│                                                             │
│                    [保存设置]                               │
└─────────────────────────────────────────────────────────────┘
```

**支持的AI模型：**

| 提供商 | 模型 | 特点 | 适用场景 |
|--------|------|------|----------|
| OpenAI | GPT-4 | 推理能力强 | 复杂法律分析 |
| OpenAI | GPT-3.5 | 速度快、成本低 | 日常查询 |
| Anthropic | Claude | 上下文长 | 长案例分析 |
| Google | Gemini | 多模态 | 综合查询 |

#### 6.2.2 智能查询系统

**AI查询界面：**
```
┌─────────────────────────────────────────────────────────────┐
│  AI 助手                                                    │
│  基于您的案例库提供智能回答                                  │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  🤖 AI: 您好！我可以帮您分析案例、解释法律概念或回答关于     │
│     您案例库的问题。请问有什么可以帮您？                     │
│                                                             │
│  ─────────────────────────────────────────────────────────  │
│                                                             │
│  快捷查询:                                                  │
│  [总结当前案例] [解释选中术语] [比较相关案例] [生成测验]    │
│                                                             │
│  ─────────────────────────────────────────────────────────  │
│                                                             │
│  💬 用户: 解释合同法中的对价(consideration)概念，并结合我    │
│     的案例库中的相关案例                                     │
│                                                             │
│  🤖 AI: 根据您的案例库，我来解释对价概念：                   │
│                                                             │
│     对价(Consideration)是合同成立的必备要素，指的是合同      │
│     双方为换取对方承诺而付出的价值。                         │
│                                                             │
│     在您收藏的案例中：                                       │
│                                                             │
│     1. Currie v. Misa (1875) - 经典对价定义                 │
│        "A valuable consideration... may consist either       │
│        in some right, interest, profit, or benefit..."       │
│        [查看案例]                                           │
│                                                             │
│     2. 您标注的案例 Smith v. Jones                          │
│        其中提到："缺乏充分对价导致合同无法执行"              │
│        [查看标注]                                           │
│                                                             │
│     关键要点：                                               │
│     • 对价必须具有法律价值，但不需要充分(adequate)           │
│     • 过去的对价(past consideration)通常不构成有效对价       │
│     • 履行现有义务一般不构成对价                             │
│                                                             │
│     您想深入了解哪个方面？                                   │
│                                                             │
│  [👍 有用] [👎 无用] [复制] [分享]                          │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│  💬 [输入您的问题...                    ] [发送]            │
└─────────────────────────────────────────────────────────────┘
```

**查询类型：**

**1. 案例总结**
```
用户: 总结案例 Smith v. Jones 的判决要旨

AI: 
【案例摘要】Smith v. Jones (2024)

📋 案件事实:
原告Smith与被告Jones签订货物买卖合同，约定Jones于2023年12月
交付100吨钢材。Jones未能按时交付，Smith起诉要求赔偿损失。

⚖️ 争议焦点:
1. 被告是否构成违约？
2. 损害赔偿金额如何计算？

📝 法院判决:
1. 被告构成根本违约(Material Breach)
2. 支持原告的损害赔偿请求
3. 赔偿金额为合同履行后可获得的预期利益

📌 判决理由:
法院援引Hadley v. Baxendale规则，认定原告的损失属于违约的
自然和可能结果，被告应当预见。

🔍 相关案例:
• Hadley v. Baxendale (1854) - 损害赔偿范围
• 您收藏的 Contract Law Principles - 违约章节

💡 学习建议:
此案例涉及合同法中的损害赔偿计算，建议复习"expectation interest"
概念。已为您生成相关闪卡。
```

**2. 概念解释**
```
用户: 什么是"Promissory Estoppel"（允诺禁反言）？

AI:
【法律概念】Promissory Estoppel 允诺禁反言

📖 定义:
即使没有对价(consideration)，如果一方合理信赖另一方的承诺
并因此采取行动，法院可以强制执行该承诺以防止不公平。

🎯 构成要件:
1. 明确的承诺 (Clear Promise)
2. 合理信赖 (Reasonable Reliance)
3. 实质性依赖行为 (Substantial Detrimental Reliance)
4. 不执行承诺将造成不公平 (Injustice)

📚 经典案例:
Central London Property Trust v. High Trees House (1947)
- 确立了现代允诺禁反言原则

🔗 与您的案例库的关联:
您在 "Contract Law Notes" 中提到：
"Promissory estoppel is a shield not a sword"
- 这是Denning法官的重要观点

📝 记忆技巧:
"没有合同，但有承诺 → 有信赖，有损失 → 法院保护"

🎴 已添加到您的词汇库，建议复习相关闪卡。
```

#### 6.2.3 AI辅助写作

**写作辅助功能：**

**1. 案例摘要生成**
```
用户选中案例全文 → 点击"AI生成摘要" → 
AI生成结构化摘要（事实/争议/判决/理由）→ 
用户可编辑保存
```

**2. 笔记整理**
```
用户输入零散笔记 → 点击"AI整理" → 
AI整理为结构化笔记（添加标题、要点、逻辑关系）→ 
生成思维导图大纲
```

**3. 测验生成**
```
用户选择案例或主题 → 点击"生成测验" → 
AI基于内容生成多种题型 → 
自动添加到学习模块
```

#### 6.2.4 智能推荐系统

**个性化推荐：**
```
🎯 今日推荐

基于您的学习进度和案例库：

1. 📚 建议学习词汇: "Tortious interference"
   原因: 您在阅读 "Smith v. Jones" 时多次遇到此术语
   [开始学习]

2. 📄 推荐案例: "Overseas Tankship v. Morts Dock" (Wagon Mound)
   原因: 与您正在学习的 "Donoghue v. Stevenson" 相关
   主题: 因果关系远程性(Remoteness of Damage)
   [查看案例]

3. 📝 复习提醒: 您有12张闪卡待复习
   预计用时: 8分钟
   [开始复习]

4. 🔍 知识缺口: 您学习了多个合同法案例，但缺少
   "Unilateral Contracts" 相关内容
   [查找相关案例]
```

### 6.3 数据库设计

**AI查询历史表 (ai_queries)：**

```sql
CREATE TABLE ai_queries (
    id VARCHAR(36) PRIMARY KEY COMMENT '查询ID',
    query TEXT NOT NULL COMMENT '查询内容',
    response TEXT COMMENT 'AI回答',
    context JSON COMMENT '上下文信息 {caseIds, noteIds, vocabIds}',
    model VARCHAR(100) COMMENT '使用的模型',
    tokens_used INT COMMENT '使用的token数',
    is_favorite BOOLEAN DEFAULT FALSE COMMENT '是否收藏',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    created_by VARCHAR(36) COMMENT '创建者ID',
    INDEX idx_created_by (created_by),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='AI查询历史表';
```

---

## 7. 用户界面模块

### 7.1 功能概述

用户界面模块采用Notion的块级编辑器和现代设计理念，提供直观、灵活、美观的用户体验。支持自定义主题、布局和多设备适配。

### 7.2 详细功能设计

#### 7.2.1 仪表盘设计

**主仪表盘布局：**
```
┌─────────────────────────────────────────────────────────────┐
│  EnofLaw                              [🔍] [🔔] [👤] [⚙️] │
├─────────────────────────────────────────────────────────────┤
│  ┌───────────────────────────────────────────────────────┐  │
│  │  欢迎回来，用户！                                       │  │
│  │  今天是您连续学习的第 15 天 🔥                          │  │
│  └───────────────────────────────────────────────────────┘  │
│                                                             │
│  ┌─────────────────────┐ ┌─────────────────────────────┐   │
│  │  📚 今日学习         │ │  📊 学习进度                 │   │
│  │                     │ │                             │   │
│  │  新词: 15/20        │ │  案例库: 128 个             │   │
│  │  复习: 32/50        │ │  词汇量: 1,250 个           │   │
│  │                     │ │  已掌握: 68%                │   │
│  │  [继续学习]         │ │                             │   │
│  │                     │ │  [查看详情]                 │   │
│  └─────────────────────┘ └─────────────────────────────┘   │
│                                                             │
│  ┌─────────────────────┐ ┌─────────────────────────────┐   │
│  │  📄 最近案例         │ │  🤖 AI 助手                 │   │
│  │                     │ │                             │   │
│  │  • Smith v. Jones   │ │  有什么法律问题？           │   │
│  │    2小时前          │ │                             │   │
│  │                     │ │  [快速提问...]              │   │
│  │  • Brown v. Board   │ │                             │   │
│  │    昨天             │ │  热门查询:                  │   │
│  │                     │ │  • 合同法原则               │   │
│  │  [查看全部]         │ │  • 过失责任构成             │   │
│  │                     │ │                             │   │
│  └─────────────────────┘ └─────────────────────────────┘   │
│                                                             │
│  ┌───────────────────────────────────────────────────────┐  │
│  │  🎯 今日推荐                                            │  │
│  │  • 复习词汇: "Jurisdiction" - 您已经3天没有复习了       │  │
│  │  • 推荐阅读: "Carlill v. Carbolic Smoke Ball" - 要约邀请 │  │
│  └───────────────────────────────────────────────────────┘  │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

#### 7.2.2 导航结构

**侧边栏导航：**
```
┌────────────────────────────────────────────┐
│  EnofLaw                    [<<]           │
├────────────────────────────────────────────┤
│  🔍 全局搜索 (Ctrl+K)                       │
├────────────────────────────────────────────┤
│  📊 仪表盘                                  │
├────────────────────────────────────────────┤
│  📁 案例库                                  │
│  ├─ 📂 合同法                               │
│  │   ├─ 📄 Smith v. Jones                  │
│  │   └─ 📄 Brown v. Board                  │
│  ├─ 📂 侵权法                               │
│  └─ 📂 刑法                                 │
├────────────────────────────────────────────┤
│  📚 词汇学习                                │
│  ├─ 我的牌组                               │
│  ├─ 学习统计                               │
│  └─ 导入/导出                              │
├────────────────────────────────────────────┤
│  📖 学习集                                  │
│  ├─ 我的学习集                             │
│  └─ 思维导图                               │
├────────────────────────────────────────────┤
│  🤖 AI 助手                                 │
│  ├─ 智能查询                               │
│  ├─ 查询历史                               │
│  └─ 设置                                   │
├────────────────────────────────────────────┤
│  ⚙️ 设置                                    │
└────────────────────────────────────────────┘
```

#### 7.2.3 主题与个性化

**主题设置：**
```
┌─────────────────────────────────────────────────────────────┐
│  外观设置                                                   │
├─────────────────────────────────────────────────────────────┤
│  主题模式                                                   │
│  ○ 浅色模式  ○ 深色模式  ● 跟随系统                         │
│                                                             │
│  强调色                                                     │
│  [🔵] [🟢] [🟡] [🟠] [🔴] [🟣] [⚫]                       │
│                                                             │
│  字体                                                       │
│  界面字体: [Inter ▼]                                        │
│  阅读字体: [Georgia ▼]                                      │
│  代码字体: [Fira Code ▼]                                    │
│                                                             │
│  字体大小                                                   │
│  小 [────●────] 大                                          │
│                                                             │
│  行间距                                                     │
│  紧凑 [──●────] 宽松                                        │
│                                                             │
│  界面密度                                                   │
│  ○ 紧凑  ● 舒适  ○ 宽松                                     │
└─────────────────────────────────────────────────────────────┘
```

---

## 8. 数据管理模块

### 8.1 功能概述

数据管理模块负责所有数据的存储、备份、同步和安全，确保用户数据的安全性和可移植性。

### 8.2 数据库设计

#### 8.2.1 数据库表结构汇总

**用户表 (users)：**

```sql
CREATE TABLE users (
    id VARCHAR(36) PRIMARY KEY COMMENT '用户ID',
    username VARCHAR(100) NOT NULL UNIQUE COMMENT '用户名',
    email VARCHAR(200) UNIQUE COMMENT '邮箱',
    password_hash VARCHAR(255) COMMENT '密码哈希',
    avatar VARCHAR(500) COMMENT '头像URL',
    settings JSON COMMENT '用户设置',
    last_login_at TIMESTAMP COMMENT '最后登录时间',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_email (email)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户表';
```

**文件夹表 (folders)：**

```sql
CREATE TABLE folders (
    id VARCHAR(36) PRIMARY KEY COMMENT '文件夹ID',
    name VARCHAR(200) NOT NULL COMMENT '文件夹名称',
    parent_id VARCHAR(36) COMMENT '父文件夹ID',
    icon VARCHAR(50) COMMENT '图标',
    color VARCHAR(20) COMMENT '颜色',
    sort_order INT DEFAULT 0 COMMENT '排序',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    created_by VARCHAR(36) COMMENT '创建者ID',
    FOREIGN KEY (parent_id) REFERENCES folders(id) ON DELETE CASCADE,
    INDEX idx_parent (parent_id),
    INDEX idx_created_by (created_by)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='文件夹表';
```

**笔记表 (notes)：**

```sql
CREATE TABLE notes (
    id VARCHAR(36) PRIMARY KEY COMMENT '笔记ID',
    title VARCHAR(500) COMMENT '笔记标题',
    content JSON COMMENT '笔记内容（块级结构）',
    parent_id VARCHAR(36) COMMENT '父笔记ID',
    case_id VARCHAR(36) COMMENT '关联案例ID',
    study_set_id VARCHAR(36) COMMENT '关联学习集ID',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    created_by VARCHAR(36) COMMENT '创建者ID',
    FOREIGN KEY (case_id) REFERENCES cases(id) ON DELETE SET NULL,
    FOREIGN KEY (study_set_id) REFERENCES study_sets(id) ON DELETE SET NULL,
    INDEX idx_case (case_id),
    INDEX idx_study_set (study_set_id),
    FULLTEXT INDEX idx_content (title) WITH PARSER ngram
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='笔记表';
```

#### 8.2.2 备份与恢复

**备份策略：**

| 备份类型 | 频率 | 保留期限 | 内容 |
|---------|------|---------|------|
| 自动备份 | 每日 | 30天 | 完整数据库+附件 |
| 手动备份 | 用户触发 | 永久 | 完整数据 |
| 导出备份 | 用户触发 | 永久 | 选择性数据 |
| 版本历史 | 实时 | 90天 | 文档变更历史 |

---

## 9. 关联与跳转功能系统

### 9.1 功能概述

关联与跳转功能系统是EnofLaw的核心连接枢纽，允许用户在案例与笔记之间、案例与案例之间、笔记与笔记之间建立双向关联关系，实现知识网络的构建和快速导航。

### 9.2 关联功能设计

**关联类型：**

| 关联类型 | 图标 | 颜色 | 说明 |
|---------|------|------|------|
| 相关 | 🔗 | #6B7280 | 一般性关联 |
| 引用 | 📖 | #3B82F6 | 引用或参考 |
| 衍生 | 🌱 | #10B981 | 基于源内容产生 |
| 对比 | ⚖️ | #F59E0B | 对比不同观点 |
| 支持 | ✅ | #22C55E | 支持性案例 |
| 推翻 | ❌ | #EF4444 | 被推翻或无效 |
| 区分 | 🔍 | #8B5CF6 | 区分相似案例 |
| 遵循 | 👣 | #06B6D4 | 遵循先例 |
| 自定义 | 🏷️ | #EC4899 | 用户自定义 |

**关联关系表 (relationships)：**

```sql
CREATE TABLE relationships (
    id VARCHAR(36) PRIMARY KEY COMMENT '关联ID',
    source_id VARCHAR(36) NOT NULL COMMENT '源实体ID',
    source_type VARCHAR(50) NOT NULL COMMENT '源实体类型: case/note/vocabulary',
    target_id VARCHAR(36) NOT NULL COMMENT '目标实体ID',
    target_type VARCHAR(50) NOT NULL COMMENT '目标实体类型: case/note/vocabulary',
    relation_type VARCHAR(50) NOT NULL DEFAULT 'related' COMMENT '关联类型',
    description TEXT COMMENT '关联描述',
    is_bidirectional BOOLEAN DEFAULT TRUE COMMENT '是否双向关联',
    pair_id VARCHAR(36) COMMENT '双向关联的另一端ID',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    created_by VARCHAR(36) COMMENT '创建者ID',
    
    UNIQUE KEY uk_relationship (source_id, target_id, relation_type),
    INDEX idx_source (source_id, source_type),
    INDEX idx_target (target_id, target_type),
    INDEX idx_type (relation_type)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='关联关系表';
```

### 9.3 分屏功能设计

**分屏布局模式：**

```
┌─────────────────────────────────────────────────────────────┐
│  分屏模式切换                                                │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  左右分屏 (默认):                                           │
│  ┌────────────────────────┬────────────────────────┐       │
│  │                        │                        │       │
│  │    主内容 (左)          │    关联内容 (右)        │       │
│  │                        │                        │       │
│  │  📄 Smith v. Jones     │  📖 Hadley v.          │       │
│  │                        │     Baxendale          │       │
│  │                        │                        │       │
│  │  [内容...]             │  [内容...]             │       │
│  │                        │                        │       │
│  └────────────────────────┴────────────────────────┘       │
│                                                             │
│  上下分屏:                                                  │
│  ┌──────────────────────────────────────────────────┐      │
│  │                                                  │      │
│  │              主内容 (上)                          │      │
│  │           📄 Smith v. Jones                      │      │
│  │                                                  │      │
│  ├──────────────────────────────────────────────────┤      │
│  │                                                  │      │
│  │              关联内容 (下)                        │      │
│  │          📖 Hadley v. Baxendale                  │      │
│  │                                                  │      │
│  └──────────────────────────────────────────────────┘      │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 10. 模块间协调与数据流

### 10.1 系统架构图

```
┌─────────────────────────────────────────────────────────────────┐
│                         用户界面层                               │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐           │
│  │ 仪表盘   │ │ 案例库   │ │ 词汇学习 │ │ AI助手   │           │
│  └────┬─────┘ └────┬─────┘ └────┬─────┘ └────┬─────┘           │
│       └─────────────┴─────────────┴─────────────┘               │
│                         │                                       │
│                    块级编辑器                                   │
└─────────────────────────┬───────────────────────────────────────┘
                          │
┌─────────────────────────┼───────────────────────────────────────┐
│                         ▼                                       │
│                      业务逻辑层                                  │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐            │
│  │ 案例管理     │ │ 学习系统     │ │ AI集成       │            │
│  │ 服务         │ │ 服务         │ │ 服务         │            │
│  └──────┬───────┘ └──────┬───────┘ └──────┬───────┘            │
│         │                │                │                     │
│         └────────────────┼────────────────┘                     │
│                          │                                      │
│                   搜索服务 │ 同步服务                            │
│                          │                                      │
└──────────────────────────┼──────────────────────────────────────┘
                           │
┌──────────────────────────┼──────────────────────────────────────┐
│                          ▼                                      │
│                       数据访问层                                 │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐            │
│  │ MySQL        │ │ 文件系统     │ │ API客户端    │            │
│  │ 数据库       │ │ 存储         │ │ (AI/翻译)    │            │
│  └──────────────┘ └──────────────┘ └──────────────┘            │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 10.2 核心业务流程

**案例学习完整流程：**
```
用户导入案例
    │
    ▼
系统自动提取元数据 + AI分析
    │
    ▼
用户阅读案例
    │
    ├──> 添加标注 ──> 保存到数据库
    │
    ├──> 划词翻译 ──> 添加到词汇库
    │
    └──> AI生成摘要 ──> 保存笔记
    │
    ▼
用户整理思维导图
    │
    ▼
生成闪卡复习
    │
    ├──> 间隔重复学习
    │
    └──> 测试检验
    │
    ▼
AI分析学习效果
    │
    ▼
推荐相关案例/词汇
    │
    ▼
循环学习
```

---

## 11. 用户流程图

### 11.1 案例导入与阅读流程

```
┌─────────┐     ┌─────────┐     ┌─────────┐     ┌─────────┐
│ 开始    │────>│ 选择    │────>│ 上传    │────>│ 解析    │
│         │     │ 导入方式 │     │ 文件    │     │ 文件    │
└─────────┘     └─────────┘     └─────────┘     └────┬────┘
                                                     │
                              ┌──────────────────────┘
                              ▼
┌─────────┐     ┌─────────┐     ┌─────────┐     ┌─────────┐
│ 完成    │<────│ 保存    │<────│ 编辑    │<────│ 提取    │
│         │     │ 案例    │     │ 元数据  │     │ 元数据  │
└─────────┘     └─────────┘     └─────────┘     └─────────┘
                              │
                              ▼
                         ┌─────────┐
                         │ AI分析  │
                         │ (可选)  │
                         └─────────┘
```

### 11.2 词汇学习流程

```
┌─────────┐     ┌─────────┐     ┌─────────┐     ┌─────────┐
│ 选择    │────>│ 显示    │────>│ 回忆    │────>│ 显示    │
│ 牌组    │     │ 卡片正面│     │ 答案    │     │ 答案    │
└─────────┘     └─────────┘     └─────────┘     └────┬────┘
                                                     │
                              ┌──────────────────────┘
                              ▼
┌─────────┐     ┌─────────┐     ┌─────────┐
│ 完成    │<────│ 更新    │<────│ 自评    │
│ 学习    │     │ SRS数据 │     │ 掌握度  │
└─────────┘     └─────────┘     └─────────┘
     │
     ▼
┌─────────┐
│ 统计    │
│ 学习    │
│ 效果    │
└─────────┘
```

### 11.3 学习集构建流程

```
┌─────────┐     ┌─────────┐     ┌─────────┐     ┌─────────┐
│ 创建    │────>│ 添加    │────>│ 整理    │────>│ 创建    │
│ 学习集  │     │ 项目    │     │ 思维导图│     │ 综合笔记│
└─────────┘     └────┬────┘     └─────────┘     └─────────┘
                     │
        ┌────────────┼────────────┐
        ▼            ▼            ▼
   ┌─────────┐  ┌─────────┐  ┌─────────┐
   │ 案例    │  │ 笔记    │  │ 资料    │
   └─────────┘  └─────────┘  └─────────┘
```

---

## 附录

### A. 界面原型索引

| 模块 | 原型图位置 | 说明 |
|------|-----------|------|
| 案例导入 | 3.2.1节 | 文件导入、元数据提取、侧边面板导入 |
| 案例库主界面 | 3.2.2节 | 卡片式布局、列表/卡片视图切换、顶部筛选栏 |
| 案例阅读器 | 3.2.3节 | 三栏布局、可折叠目录、Markdown编辑 |
| 案例标注 | 3.2.3节 | 高亮、批注、评论系统（飞书云文档风格） |
| 全文搜索 | 3.2.4节 | 全局搜索(Ctrl+K)、高级筛选面板 |
| 协作分享 | 3.2.5节 | 案例分享链接、团队共享文件夹、@提及 |
| 快捷键系统 | 3.2.6节 | 全局快捷键、阅读器快捷键、自定义快捷键 |
| 案例对比 | 3.2.7节 | 并排对比查看、AI对比分析 |
| 阅读统计 | 3.2.8节 | 阅读时长、进度统计、导出功能 |
| AI分析 | 3.2.9节 | 争议点、法律规则提取 |
| 个人笔记 | 3.2.10节 | Markdown编辑器 |
| 文件夹管理 | 3.2.11节 | 左侧文件夹目录、拖拽排序、无弹窗新建/重命名 |
| 案例查找资源 | 3.2.12节 | 法律数据库链接面板、免费/付费平台分类 |
| 划词翻译 | 4.2.1节 | 侧边栏翻译工具 |
| 单词卡片 | 4.2.2节 | 词汇卡片生成 |
| 闪卡学习 | 4.2.3节 | SRS学习界面 |
| 学习集 | 5.2.1节 | 学习集管理 |
| 思维导图 | 5.2.2节 | 可视化导图编辑 |
| AI助手 | 6.2.2节 | 智能问答界面 |
| 仪表盘 | 7.2.1节 | 主界面布局 |
| 关联系统 | 9.2节 | 双向关联管理 |
| 分屏功能 | 9.3节 | 并排对比查看 |

### B. 技术实现建议

**前端技术栈:**
- 框架: Vue 3 + TypeScript
- 状态管理: Pinia
- UI组件: ElementPlus
- 块编辑器: Editor.js / Milkdown
- 思维导图: D3.js / Cytoscape.js
- PDF渲染: PDF.js
- 图表: ECharts
- Markdown渲染: marked
- 拖拽排序: vuedraggable
- 快捷键: hotkeys-js
- 搜索: fuse.js (本地搜索) / Elasticsearch (服务端)

**后端技术栈:**
- 框架: SpringBoot 3.x
- ORM: Mybatis + PageHelper
- 数据库: MySQL 8.0
- 缓存: Redis
- 搜索: Elasticsearch + IK分词器
- AI集成: OpenAI SDK
- 文件处理: Apache PDFBox
- 分享链接: 短链接服务 (Hashids)
- 版本控制: Git-like版本管理

**性能优化:**
- 数据库索引优化
- Redis缓存热点数据
- Elasticsearch全文搜索
- 分页查询（PageHelper）
- 文件分片上传/下载
- 虚拟滚动（长列表优化）
- 防抖节流（搜索、自动保存）

### C. 开发优先级建议

**第一阶段 (MVP):**
1. 案例导入和基础阅读（PDF/TXT）
2. 简单标注功能（高亮、批注）
3. 基础词汇库和划词翻译
4. 简单闪卡学习

**第二阶段:**
1. 思维导图功能
2. 高级搜索
3. AI集成基础功能（摘要生成）
4. 学习集功能

**第三阶段:**
1. 块级编辑器
2. 高级AI功能（智能分析）
3. 案例关联对比
4. 智能复习系统完善

**第四阶段:**
1. 知识图谱可视化
2. 高级推荐系统
3. 协作功能
4. 移动端适配

### D. API设计规范

**RESTful API规范：**

```
案例管理API:
GET    /api/cases              # 获取案例列表
POST   /api/cases              # 创建案例
GET    /api/cases/{id}         # 获取案例详情
PUT    /api/cases/{id}         # 更新案例
DELETE /api/cases/{id}         # 删除案例
POST   /api/cases/{id}/import  # 导入案例文件

标注API:
GET    /api/cases/{id}/annotations      # 获取案例标注
POST   /api/cases/{id}/annotations      # 创建标注
PUT    /api/annotations/{id}            # 更新标注
DELETE /api/annotations/{id}            # 删除标注

词汇API:
GET    /api/vocabulary         # 获取词汇列表
POST   /api/vocabulary         # 创建词汇卡片
GET    /api/vocabulary/{id}    # 获取词汇详情
PUT    /api/vocabulary/{id}    # 更新词汇
DELETE /api/vocabulary/{id}    # 删除词汇
POST   /api/vocabulary/{id}/review     # 提交复习结果

AI API:
POST   /api/ai/analyze         # AI分析案例
POST   /api/ai/query           # AI智能查询
POST   /api/ai/summarize       # 生成摘要
POST   /api/ai/generate-quiz   # 生成测验

学习集API:
GET    /api/study-sets         # 获取学习集列表
POST   /api/study-sets         # 创建学习集
GET    /api/study-sets/{id}    # 获取学习集详情
PUT    /api/study-sets/{id}    # 更新学习集
DELETE /api/study-sets/{id}    # 删除学习集
```

---

**文档版本历史**

| 版本 | 日期 | 修改内容 | 作者 |
|------|------|----------|------|
| v1.1 | 2026-02-23 | 更新案例阅读器标注颜色选择、评论功能重构（飞书云文档风格）、标注叠加显示、文件夹功能增强、导入功能增强 | AI Assistant |
| v1.0 | 2026-02-22 | 初始版本，完善案例管理、法律英语学习、知识库管理模块详细设计 | AI Assistant |
